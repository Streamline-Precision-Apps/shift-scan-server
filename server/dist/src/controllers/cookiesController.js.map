{"version":3,"file":"cookiesController.js","sources":["src/controllers/cookiesController.ts"],"sourceRoot":"/","sourcesContent":["// GET /api/cookies?name=key\nimport express from \"express\";\n\nexport function getCookie(req: express.Request, res: express.Response) {\n  let { name } = req.query;\n  if (!name) {\n    console.warn(\"❌ GET cookie: Missing cookie name parameter\");\n    return res.status(400).json({ error: \"Missing cookie name\" });\n  }\n  if (Array.isArray(name)) name = name[0];\n  if (typeof name !== \"string\") {\n    console.warn(\"❌ GET cookie: Invalid cookie name type\");\n    return res.status(400).json({ error: \"Invalid cookie name\" });\n  }\n\n  const value = req.cookies?.[name];\n\n  if (value === undefined) {\n    if (name === \"currentPageView\") {\n      return res.status(200).json({ value: \"\" });\n    }\n    console.warn(`⚠️  Cookie not found: ${name}`);\n    return res.status(204).send(); // No Content\n  }\n\n  res.json({ value });\n}\n\n// GET /api/cookies?name=key1&name=key2&name=key3\nexport function getCookieList(req: express.Request, res: express.Response) {\n  let { name } = req.query;\n  if (!name) {\n    console.warn(\"❌ GET cookies: Missing cookie name parameter\");\n    return res.status(400).json({ error: \"Missing cookie name(s)\" });\n  }\n  if (typeof name === \"string\") {\n    name = [name];\n  }\n  if (!Array.isArray(name) || !name.every((n) => typeof n === \"string\")) {\n    console.warn(\"❌ GET cookies: Invalid cookie name type\");\n    return res.status(400).json({ error: \"Invalid cookie name(s)\" });\n  }\n\n  const values: Record<string, string | undefined> = {};\n  name.forEach((cookieName) => {\n    values[cookieName] = req.cookies?.[cookieName];\n  });\n\n  res.json({ value: values });\n}\n\n// POST or PUT /api/cookies { name, value, options }\n// UPSERT: Creates cookie if it doesn't exist, updates if it does\nexport function setCookie(req: express.Request, res: express.Response) {\n  const { name, value, options } = req.body;\n\n  if (!name || value === undefined) {\n    console.error(\"❌ Missing name or value in request\");\n    return res.status(400).json({ error: \"Missing name or value\" });\n  }\n  // Get current cookie value to check if it exists\n  const existingValue = req.cookies?.[name];\n  const isUpdate = existingValue !== undefined;\n\n  // IMPORTANT: Set proper cookie options to ensure browser receives it\n  const cookieOptions = {\n    path: \"/\",\n    httpOnly: false, // Must be false so client can read it\n    maxAge: 60 * 60 * 24 * 365, // 1 year\n    ...options, // Merge with provided options\n  };\n\n  // Set the cookie\n  res.cookie(name, value, cookieOptions);\n\n  res.json({\n    message: `Cookie ${isUpdate ? \"updated\" : \"created\"}`,\n    name,\n    value,\n    action: isUpdate ? \"UPDATE\" : \"CREATE\",\n    options: cookieOptions,\n  });\n} // DELETE /api/cookies?name=key or /api/cookies (delete all)\nexport function deleteCookie(req: express.Request, res: express.Response) {\n  let { name } = req.query;\n  if (name) {\n    if (Array.isArray(name)) name = name[0];\n    if (typeof name === \"string\") {\n      res.clearCookie(name);\n      return res.json({ message: `Cookie '${name}' deleted` });\n    } else {\n      return res.status(400).json({ error: \"Invalid cookie name\" });\n    }\n  }\n  // Delete all cookies\n  if (req.cookies) {\n    Object.keys(req.cookies).forEach((cookieName) => {\n      res.clearCookie(cookieName);\n    });\n  }\n  res.json({ message: \"All cookies deleted\" });\n}\n\nexport function deleteAllCookie(req: express.Request, res: express.Response) {\n  // Always delete all cookies, regardless of query params\n  if (req.cookies) {\n    Object.keys(req.cookies).forEach((cookieName) => {\n      res.clearCookie(cookieName);\n    });\n  }\n  res.json({ message: \"All cookies deleted\" });\n}\n\n// DELETE /api/cookies/list?name=key1&name=key2\nexport function deleteCookieList(req: express.Request, res: express.Response) {\n  let { name } = req.query;\n  if (!name) {\n    return res.status(400).json({ error: \"Missing cookie name(s)\" });\n  }\n  if (typeof name === \"string\") {\n    name = [name];\n  }\n  if (!Array.isArray(name) || !name.every((n) => typeof n === \"string\")) {\n    return res.status(400).json({ error: \"Invalid cookie name(s)\" });\n  }\n\n  name.forEach((cookieName) => {\n    res.clearCookie(cookieName);\n  });\n  res.json({ message: `Cookies deleted: ${name.join(\", \")}` });\n}\n"],"names":[],"mappings":"AAAA,4BAA4B;;;AAC5B,OAAO,OAAO,MAAM,SAAS,CAAC;AAE9B,MAAM,UAAU,SAAS,CAAC,GAAoB,EAAE,GAAqB;IACnE,IAAI,EAAE,IAAI,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC;IACzB,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,OAAO,CAAC,IAAI,CAAC,6CAA6C,CAAC,CAAC;QAC5D,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,qBAAqB,EAAE,CAAC,CAAC;IAChE,CAAC;IACD,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC;QAAE,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;IACxC,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE,CAAC;QAC7B,OAAO,CAAC,IAAI,CAAC,wCAAwC,CAAC,CAAC;QACvD,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,qBAAqB,EAAE,CAAC,CAAC;IAChE,CAAC;IAED,MAAM,KAAK,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;IAElC,IAAI,KAAK,KAAK,SAAS,EAAE,CAAC;QACxB,IAAI,IAAI,KAAK,iBAAiB,EAAE,CAAC;YAC/B,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC;QAC7C,CAAC;QACD,OAAO,CAAC,IAAI,CAAC,yBAAyB,IAAI,EAAE,CAAC,CAAC;QAC9C,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC,aAAa;IAC9C,CAAC;IAED,GAAG,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,CAAC,CAAC;AACtB,CAAC;AAED,iDAAiD;AACjD,MAAM,UAAU,aAAa,CAAC,GAAoB,EAAE,GAAqB;IACvE,IAAI,EAAE,IAAI,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC;IACzB,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,OAAO,CAAC,IAAI,CAAC,8CAA8C,CAAC,CAAC;QAC7D,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,wBAAwB,EAAE,CAAC,CAAC;IACnE,CAAC;IACD,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE,CAAC;QAC7B,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC;IAChB,CAAC;IACD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,OAAO,CAAC,KAAK,QAAQ,CAAC,EAAE,CAAC;QACtE,OAAO,CAAC,IAAI,CAAC,yCAAyC,CAAC,CAAC;QACxD,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,wBAAwB,EAAE,CAAC,CAAC;IACnE,CAAC;IAED,MAAM,MAAM,GAAuC,EAAE,CAAC;IACtD,IAAI,CAAC,OAAO,CAAC,CAAC,UAAU,EAAE,EAAE;QAC1B,MAAM,CAAC,UAAU,CAAC,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC,UAAU,CAAC,CAAC;IACjD,CAAC,CAAC,CAAC;IAEH,GAAG,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,MAAM,EAAE,CAAC,CAAC;AAC9B,CAAC;AAED,oDAAoD;AACpD,iEAAiE;AACjE,MAAM,UAAU,SAAS,CAAC,GAAoB,EAAE,GAAqB;IACnE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,GAAG,CAAC,IAAI,CAAC;IAE1C,IAAI,CAAC,IAAI,IAAI,KAAK,KAAK,SAAS,EAAE,CAAC;QACjC,OAAO,CAAC,KAAK,CAAC,oCAAoC,CAAC,CAAC;QACpD,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,uBAAuB,EAAE,CAAC,CAAC;IAClE,CAAC;IACD,iDAAiD;IACjD,MAAM,aAAa,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC,CAAC;IAC1C,MAAM,QAAQ,GAAG,aAAa,KAAK,SAAS,CAAC;IAE7C,qEAAqE;IACrE,MAAM,aAAa,GAAG;QACpB,IAAI,EAAE,GAAG;QACT,QAAQ,EAAE,KAAK,EAAE,sCAAsC;QACvD,MAAM,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,GAAG,EAAE,SAAS;QACrC,GAAG,OAAO,EAAE,8BAA8B;KAC3C,CAAC;IAEF,iBAAiB;IACjB,GAAG,CAAC,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE,aAAa,CAAC,CAAC;IAEvC,GAAG,CAAC,IAAI,CAAC;QACP,OAAO,EAAE,UAAU,QAAQ,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,SAAS,EAAE;QACrD,IAAI;QACJ,KAAK;QACL,MAAM,EAAE,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ;QACtC,OAAO,EAAE,aAAa;KACvB,CAAC,CAAC;AACL,CAAC,CAAC,4DAA4D;AAC9D,MAAM,UAAU,YAAY,CAAC,GAAoB,EAAE,GAAqB;IACtE,IAAI,EAAE,IAAI,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC;IACzB,IAAI,IAAI,EAAE,CAAC;QACT,IAAI,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC;YAAE,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC;QACxC,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE,CAAC;YAC7B,GAAG,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;YACtB,OAAO,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,WAAW,IAAI,WAAW,EAAE,CAAC,CAAC;QAC3D,CAAC;aAAM,CAAC;YACN,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,qBAAqB,EAAE,CAAC,CAAC;QAChE,CAAC;IACH,CAAC;IACD,qBAAqB;IACrB,IAAI,GAAG,CAAC,OAAO,EAAE,CAAC;QAChB,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,CAAC,UAAU,EAAE,EAAE;YAC9C,GAAG,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;QAC9B,CAAC,CAAC,CAAC;IACL,CAAC;IACD,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,qBAAqB,EAAE,CAAC,CAAC;AAC/C,CAAC;AAED,MAAM,UAAU,eAAe,CAAC,GAAoB,EAAE,GAAqB;IACzE,wDAAwD;IACxD,IAAI,GAAG,CAAC,OAAO,EAAE,CAAC;QAChB,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,OAAO,CAAC,CAAC,UAAU,EAAE,EAAE;YAC9C,GAAG,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;QAC9B,CAAC,CAAC,CAAC;IACL,CAAC;IACD,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,qBAAqB,EAAE,CAAC,CAAC;AAC/C,CAAC;AAED,+CAA+C;AAC/C,MAAM,UAAU,gBAAgB,CAAC,GAAoB,EAAE,GAAqB;IAC1E,IAAI,EAAE,IAAI,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC;IACzB,IAAI,CAAC,IAAI,EAAE,CAAC;QACV,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,wBAAwB,EAAE,CAAC,CAAC;IACnE,CAAC;IACD,IAAI,OAAO,IAAI,KAAK,QAAQ,EAAE,CAAC;QAC7B,IAAI,GAAG,CAAC,IAAI,CAAC,CAAC;IAChB,CAAC;IACD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,OAAO,CAAC,KAAK,QAAQ,CAAC,EAAE,CAAC;QACtE,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,wBAAwB,EAAE,CAAC,CAAC;IACnE,CAAC;IAED,IAAI,CAAC,OAAO,CAAC,CAAC,UAAU,EAAE,EAAE;QAC1B,GAAG,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;IAC9B,CAAC,CAAC,CAAC;IACH,GAAG,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,oBAAoB,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,CAAC,CAAC;AAC/D,CAAC","debug_id":"3b1b6516-59f7-5b49-91f6-8b9dbdb79225"}