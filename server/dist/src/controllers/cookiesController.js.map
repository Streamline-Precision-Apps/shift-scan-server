{"version":3,"file":"cookiesController.js","sources":["src/controllers/cookiesController.ts"],"sourceRoot":"/","sourcesContent":["// GET /api/cookies?name=key\r\nimport express from \"express\";\r\n\r\nexport function getCookie(req: express.Request, res: express.Response) {\r\n  let { name } = req.query;\r\n  if (!name) {\r\n    console.warn(\"❌ GET cookie: Missing cookie name parameter\");\r\n    return res.status(400).json({ error: \"Missing cookie name\" });\r\n  }\r\n  if (Array.isArray(name)) name = name[0];\r\n  if (typeof name !== \"string\") {\r\n    console.warn(\"❌ GET cookie: Invalid cookie name type\");\r\n    return res.status(400).json({ error: \"Invalid cookie name\" });\r\n  }\r\n\r\n  const value = req.cookies?.[name];\r\n\r\n  if (value === undefined) {\r\n    if (name === \"currentPageView\") {\r\n      return res.status(200).json({ value: \"\" });\r\n    }\r\n    console.warn(`⚠️  Cookie not found: ${name}`);\r\n    return res.status(204).send(); // No Content\r\n  }\r\n\r\n  res.json({ value });\r\n}\r\n\r\n// GET /api/cookies?name=key1&name=key2&name=key3\r\nexport function getCookieList(req: express.Request, res: express.Response) {\r\n  let { name } = req.query;\r\n  if (!name) {\r\n    console.warn(\"❌ GET cookies: Missing cookie name parameter\");\r\n    return res.status(400).json({ error: \"Missing cookie name(s)\" });\r\n  }\r\n  if (typeof name === \"string\") {\r\n    name = [name];\r\n  }\r\n  if (!Array.isArray(name) || !name.every((n) => typeof n === \"string\")) {\r\n    console.warn(\"❌ GET cookies: Invalid cookie name type\");\r\n    return res.status(400).json({ error: \"Invalid cookie name(s)\" });\r\n  }\r\n\r\n  const values: Record<string, string | undefined> = {};\r\n  name.forEach((cookieName) => {\r\n    values[cookieName] = req.cookies?.[cookieName];\r\n  });\r\n\r\n  res.json({ value: values });\r\n}\r\n\r\n// POST or PUT /api/cookies { name, value, options }\r\n// UPSERT: Creates cookie if it doesn't exist, updates if it does\r\nexport function setCookie(req: express.Request, res: express.Response) {\r\n  const { name, value, options } = req.body;\r\n\r\n  if (!name || value === undefined) {\r\n    console.error(\"❌ Missing name or value in request\");\r\n    return res.status(400).json({ error: \"Missing name or value\" });\r\n  }\r\n  // Get current cookie value to check if it exists\r\n  const existingValue = req.cookies?.[name];\r\n  const isUpdate = existingValue !== undefined;\r\n\r\n  // IMPORTANT: Set proper cookie options to ensure browser receives it\r\n  const cookieOptions = {\r\n    path: \"/\",\r\n    httpOnly: false, // Must be false so client can read it\r\n    maxAge: 60 * 60 * 24 * 365, // 1 year\r\n    ...options, // Merge with provided options\r\n  };\r\n\r\n  // Set the cookie\r\n  res.cookie(name, value, cookieOptions);\r\n\r\n  res.json({\r\n    message: `Cookie ${isUpdate ? \"updated\" : \"created\"}`,\r\n    name,\r\n    value,\r\n    action: isUpdate ? \"UPDATE\" : \"CREATE\",\r\n    options: cookieOptions,\r\n  });\r\n} // DELETE /api/cookies?name=key or /api/cookies (delete all)\r\nexport function deleteCookie(req: express.Request, res: express.Response) {\r\n  let { name } = req.query;\r\n  if (name) {\r\n    if (Array.isArray(name)) name = name[0];\r\n    if (typeof name === \"string\") {\r\n      res.clearCookie(name);\r\n      return res.json({ message: `Cookie '${name}' deleted` });\r\n    } else {\r\n      return res.status(400).json({ error: \"Invalid cookie name\" });\r\n    }\r\n  }\r\n  // Delete all cookies\r\n  if (req.cookies) {\r\n    Object.keys(req.cookies).forEach((cookieName) => {\r\n      res.clearCookie(cookieName);\r\n    });\r\n  }\r\n  res.json({ message: \"All cookies deleted\" });\r\n}\r\n\r\nexport function deleteAllCookie(req: express.Request, res: express.Response) {\r\n  // Always delete all cookies, regardless of query params\r\n  if (req.cookies) {\r\n    Object.keys(req.cookies).forEach((cookieName) => {\r\n      res.clearCookie(cookieName);\r\n    });\r\n  }\r\n  res.json({ message: \"All cookies deleted\" });\r\n}\r\n\r\n// DELETE /api/cookies/list?name=key1&name=key2\r\nexport function deleteCookieList(req: express.Request, res: express.Response) {\r\n  let { name } = req.query;\r\n  if (!name) {\r\n    return res.status(400).json({ error: \"Missing cookie name(s)\" });\r\n  }\r\n  if (typeof name === \"string\") {\r\n    name = [name];\r\n  }\r\n  if (!Array.isArray(name) || !name.every((n) => typeof n === \"string\")) {\r\n    return res.status(400).json({ error: \"Invalid cookie name(s)\" });\r\n  }\r\n\r\n  name.forEach((cookieName) => {\r\n    res.clearCookie(cookieName);\r\n  });\r\n  res.json({ message: `Cookies deleted: ${name.join(\", \")}` });\r\n}\r\n"],"names":[],"mappings":"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","debug_id":"f1a674c9-7a66-5aac-8abc-e9eb0e4a465b"}