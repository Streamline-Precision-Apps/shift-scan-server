{"version":3,"file":"adminEquipmentController.js","sources":["src/controllers/adminEquipmentController.ts"],"sourceRoot":"/","sourcesContent":["import type { Request, Response } from \"express\";\r\nimport type { AuthenticatedRequest } from \"../middleware/authMiddleware.js\";\r\nimport {\r\n  createEquipmentService,\r\n  editEquipmentService,\r\n  archiveEquipmentService,\r\n  restoreEquipmentService,\r\n  deleteEquipmentService,\r\n  getAllEquipmentService,\r\n  getEquipmentByIdService,\r\n  getEquipmentSummaryService,\r\n} from \"../services/adminsEquipmentService.js\";\r\nimport type { GetAllEquipmentServiceParams } from \"../services/adminsEquipmentService.js\";\r\n\r\n// GET /api/v1/admins/equipment - List all equipment\r\nexport async function listEquipment(req: Request, res: Response) {\r\n  try {\r\n    const { status, filters, search = \"\", page = 1, pageSize = 25 } = req.query;\r\n\r\n    const params: GetAllEquipmentServiceParams = {\r\n      status: status as string,\r\n      filtersParam: filters as string,\r\n      searchTerm: search as string,\r\n      requestedPage: parseInt(page as string, 10) || 1,\r\n      requestedPageSize: parseInt(pageSize as string, 10) || 25,\r\n    };\r\n\r\n    const result = await getAllEquipmentService(params);\r\n    res.json(result);\r\n  } catch (error) {\r\n    res.status(500).json({ message: \"Failed to fetch equipment\", error });\r\n  }\r\n}\r\n\r\nexport async function getEquipmentSummary(req: Request, res: Response) {\r\n  try {\r\n    const result = await getEquipmentSummaryService();\r\n    res.json(result);\r\n  } catch (error) {\r\n    res.status(500).json({ message: \"Failed to fetch equipment\", error });\r\n  }\r\n}\r\n\r\n// GET /api/v1/admins/equipment/:id - Get equipment by ID\r\nexport async function getEquipmentById(req: Request, res: Response) {\r\n  try {\r\n    const id = req.params.id as string;\r\n    const equipment = await getEquipmentByIdService(id);\r\n    if (!equipment) {\r\n      return res.status(404).json({ message: \"Equipment not found\" });\r\n    }\r\n    res.json(equipment);\r\n  } catch (error) {\r\n    res.status(500).json({ message: \"Failed to fetch equipment\", error });\r\n  }\r\n}\r\n\r\n// POST /api/v1/admins/equipment - Create new equipment\r\nexport async function createEquipment(req: Request, res: Response) {\r\n  try {\r\n    // TODO: Get createdById and qrId from auth/session or request\r\n    const createdById = req.body.createdById || \"\";\r\n    const qrId = req.body.qrId || \"\";\r\n    const equipment = await createEquipmentService(req.body, createdById, qrId);\r\n    res.status(201).json(equipment);\r\n  } catch (error) {\r\n    res.status(500).json({ message: \"Failed to create equipment\", error });\r\n  }\r\n}\r\n\r\n// PUT /api/v1/admins/equipment/:id - Update equipment by ID\r\nexport async function updateEquipment(\r\n  req: AuthenticatedRequest,\r\n  res: Response\r\n) {\r\n  try {\r\n    const id = req.params.id as string;\r\n    const userId = req.user?.id || \"\";\r\n    \r\n    if (!userId) {\r\n      return res.status(401).json({ message: \"User not authenticated\" });\r\n    }\r\n    \r\n    const equipment = await editEquipmentService(id, req.body, userId);\r\n    res.json(equipment);\r\n  } catch (error) {\r\n    res.status(500).json({ message: \"Failed to update equipment\", error });\r\n  }\r\n}\r\n\r\n// DELETE /api/v1/admins/equipment/:id - Delete equipment by ID (hard delete)\r\nexport async function deleteEquipment(req: Request, res: Response) {\r\n  try {\r\n    const id = req.params.id as string;\r\n    const equipment = await deleteEquipmentService(id);\r\n    res.json(equipment);\r\n  } catch (error) {\r\n    res.status(500).json({ message: \"Failed to delete equipment\", error });\r\n  }\r\n}\r\n\r\n// PUT /api/v1/admins/equipment/:id/archive - Archive equipment by ID (update status)\r\nexport async function archiveEquipment(req: Request, res: Response) {\r\n  try {\r\n    const id = req.params.id as string;\r\n    const equipment = await archiveEquipmentService(id);\r\n    res.json(equipment);\r\n  } catch (error) {\r\n    res.status(500).json({ message: \"Failed to archive equipment\", error });\r\n  }\r\n}\r\n\r\n// PUT /api/v1/admins/equipment/:id/restore - Restore archived equipment by ID\r\nexport async function restoreEquipment(req: Request, res: Response) {\r\n  try {\r\n    const id = req.params.id as string;\r\n    const equipment = await restoreEquipmentService(id);\r\n    res.json(equipment);\r\n  } catch (error) {\r\n    res.status(500).json({ message: \"Failed to restore equipment\", error });\r\n  }\r\n}\r\n\r\n// GET /api/v1/admins/equipment/archived - List all archived equipment\r\nexport async function listArchivedEquipment(req: Request, res: Response) {\r\n  try {\r\n    // Reuse listEquipment with status filter\r\n    req.query.status = \"ARCHIVED\";\r\n    await listEquipment(req, res);\r\n  } catch (error) {\r\n    res\r\n      .status(500)\r\n      .json({ message: \"Failed to fetch archived equipment\", error });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debug_id":"00dd1bc9-470d-5d48-b217-c4c7e58b55f4"}