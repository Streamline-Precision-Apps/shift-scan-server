{"version":3,"file":"blobsController.js","sources":["src/controllers/blobsController.ts"],"sourceRoot":"/","sourcesContent":["import type { Request, Response } from \"express\";\r\nimport { getFirebaseAdmin } from \"../lib/firebase.js\";\r\n\r\nexport async function blobUpload(req: Request, res: Response) {\r\n  try {\r\n    const admin = getFirebaseAdmin();\r\n    const bucket = admin.storage().bucket();\r\n\r\n    const userId = req.body.userId;\r\n    const file = req.file;\r\n    const folder = req.body.folder || \"profileImages\";\r\n    console.log(\"file\", file);\r\n\r\n    if (!userId) {\r\n      return res.status(400).json({ error: \"No userId provided\" });\r\n    }\r\n    if (!file) {\r\n      return res.status(400).json({ error: \"No file provided\" });\r\n    }\r\n\r\n    // Upsert: Save file (creates if new, overwrites if exists)\r\n    const fileRef = bucket.file(`${folder}/${userId}.png`);\r\n    const contentType = folder === \"docs\" ? \"application/pdf\" : \"image/png\";\r\n\r\n    await fileRef.save(file.buffer, {\r\n      contentType,\r\n      public: true,\r\n      metadata: {\r\n        cacheControl: \"no-cache\", // Prevent caching old images\r\n      },\r\n    });\r\n\r\n    const publicUrl = `https://storage.googleapis.com/${bucket.name}/${fileRef.name}`;\r\n\r\n    return res.status(200).json({\r\n      url: publicUrl,\r\n      message: \"Image uploaded successfully\",\r\n    });\r\n  } catch (err) {\r\n    console.error(\"Upload error:\", err);\r\n    return res.status(500).json({ error: \"Upload failed\" });\r\n  }\r\n}\r\n\r\nexport async function blobDelete(req: Request, res: Response) {\r\n  try {\r\n    const admin = getFirebaseAdmin();\r\n    const bucket = admin.storage().bucket();\r\n    const { userId, folder = \"profileImages\" } = req.body;\r\n    if (!userId) {\r\n      return res.status(400).json({ error: \"No userId provided\" });\r\n    }\r\n    const fileRef = bucket.file(`${folder}/${userId}.png`);\r\n    const [exists] = await fileRef.exists();\r\n    if (!exists) {\r\n      return res.status(404).json({ error: \"File not found\" });\r\n    }\r\n    await fileRef.delete();\r\n    return res.json({ success: true });\r\n  } catch (err) {\r\n    console.error(err);\r\n    return res.status(500).json({ error: \"Delete failed\" });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debug_id":"da5d4362-b884-5ccc-990b-a857daadb8ae"}