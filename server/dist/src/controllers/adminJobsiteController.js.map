{"version":3,"file":"adminJobsiteController.js","sources":["src/controllers/adminJobsiteController.ts"],"sourceRoot":"/","sourcesContent":["import type { Request, Response } from \"express\";\r\nimport {\r\n  getAllJobsites,\r\n  getJobsiteById,\r\n  createJobsite,\r\n  updateJobsite,\r\n  archiveJobsite,\r\n  restoreJobsite,\r\n  deleteJobsite,\r\n} from \"../services/adminJobsiteService.js\";\r\n\r\n// GET /api/v1/admins/jobsite\r\nexport async function getAllJobsitesController(req: Request, res: Response) {\r\n  try {\r\n    const status = typeof req.query.status === \"string\" ? req.query.status : \"\";\r\n    const page = req.query.page ? parseInt(req.query.page as string, 10) : 1;\r\n    const pageSize = req.query.pageSize\r\n      ? parseInt(req.query.pageSize as string, 10)\r\n      : 25;\r\n    let skip = (page - 1) * pageSize;\r\n    let totalPages = 1;\r\n    let total = 0;\r\n    const result = await getAllJobsites(\r\n      status,\r\n      page,\r\n      pageSize,\r\n      skip,\r\n      totalPages,\r\n      total\r\n    );\r\n    res.status(200).json(result);\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: \"Failed to fetch jobsites\",\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n}\r\n\r\n// GET /api/v1/admins/jobsite/:id\r\nexport async function getJobsiteByIdController(req: Request, res: Response) {\r\n  try {\r\n    const { id } = req.params;\r\n    if (!id) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Jobsite ID is required\",\r\n      });\r\n    }\r\n    const jobsite = await getJobsiteById(id);\r\n    if (!jobsite) {\r\n      return res.status(404).json({\r\n        success: false,\r\n        message: \"Jobsite not found\",\r\n      });\r\n    }\r\n    res.status(200).json(jobsite);\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: \"Failed to fetch jobsite\",\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n}\r\n\r\n// --- Types for Jobsite creation and update ---\r\nexport interface JobsiteCreateBody {\r\n  code: string;\r\n  name: string;\r\n  description: string;\r\n  ApprovalStatus: string;\r\n  status: string;\r\n  Address: {\r\n    street: string;\r\n    city: string;\r\n    state: string;\r\n    zipCode: string;\r\n  };\r\n  Client?: {\r\n    id: string;\r\n  } | null;\r\n  CCTags?: Array<{ id: string }>;\r\n  CreatedVia: string;\r\n  createdById: string;\r\n}\r\n\r\nexport interface JobsiteUpdateBody {\r\n  code?: string;\r\n  name?: string;\r\n  description?: string;\r\n  approvalStatus?: string;\r\n  status?: string;\r\n  creationReason?: string;\r\n  CCTags?: Array<{ id: string }>;\r\n  Address?: {\r\n    street: string;\r\n    city: string;\r\n    state: string;\r\n    zipCode: string;\r\n  };\r\n  updatedAt?: Date;\r\n  userId: string;\r\n}\r\n\r\n// POST /api/v1/admins/jobsite\r\nexport async function createJobsiteController(\r\n  req: Request<{}, {}, JobsiteCreateBody>,\r\n  res: Response\r\n) {\r\n  try {\r\n    const payload = req.body;\r\n    await createJobsite(payload);\r\n    res.status(201).json({\r\n      success: true,\r\n      message: \"Jobsite created successfully\",\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: \"Failed to create jobsite\",\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n}\r\n\r\n// PUT /api/v1/admins/jobsite/:id\r\nexport async function updateJobsiteController(\r\n  req: Request<{ id: string }, {}, JobsiteUpdateBody>,\r\n  res: Response\r\n) {\r\n  try {\r\n    const { id } = req.params;\r\n    if (!id) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Jobsite ID is required\",\r\n      });\r\n    }\r\n    const updateData = req.body;\r\n    // You may want to get userId from auth middleware/session\r\n    const updated = await updateJobsite(id, updateData);\r\n    res.status(200).json({\r\n      success: true,\r\n      message: \"Jobsite updated successfully\",\r\n      data: updated,\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: \"Failed to update jobsite\",\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n}\r\n\r\n// PUT /api/v1/admins/jobsite/:id/archive\r\nexport async function archiveJobsiteController(req: Request, res: Response) {\r\n  try {\r\n    const { id } = req.params;\r\n    if (!id) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Jobsite ID is required\",\r\n      });\r\n    }\r\n\r\n    await archiveJobsite(id);\r\n    res.status(200).json({\r\n      success: true,\r\n      message: \"Jobsite archived successfully\",\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: \"Failed to archive jobsite\",\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n}\r\n\r\n// PUT /api/v1/admins/jobsite/:id/restore\r\nexport async function restoreJobsiteController(req: Request, res: Response) {\r\n  try {\r\n    const { id } = req.params;\r\n    if (!id) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Jobsite ID is required\",\r\n      });\r\n    }\r\n    await restoreJobsite(id);\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: \"Jobsite restored successfully\",\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: \"Failed to restore jobsite\",\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n}\r\n\r\n// DELETE /api/v1/admins/jobsite/:id\r\nexport async function deleteJobsiteController(req: Request, res: Response) {\r\n  try {\r\n    const { id } = req.params;\r\n    if (!id) {\r\n      return res.status(400).json({\r\n        success: false,\r\n        message: \"Jobsite ID is required\",\r\n      });\r\n    }\r\n    await deleteJobsite(id);\r\n    res.status(200).json({\r\n      success: true,\r\n      message: \"Jobsite deleted successfully\",\r\n    });\r\n  } catch (error) {\r\n    res.status(500).json({\r\n      success: false,\r\n      message: \"Failed to delete jobsite\",\r\n      error: error instanceof Error ? error.message : \"Unknown error\",\r\n    });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debug_id":"fc98e05f-93b1-5e8b-9c1f-bce1bec4e935"}