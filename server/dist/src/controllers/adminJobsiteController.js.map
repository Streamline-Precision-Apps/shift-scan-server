{"version":3,"file":"adminJobsiteController.js","sources":["src/controllers/adminJobsiteController.ts"],"sourceRoot":"/","sourcesContent":["import type { Request, Response } from \"express\";\nimport {\n  getAllJobsites,\n  getJobsiteById,\n  createJobsite,\n  updateJobsite,\n  archiveJobsite,\n  restoreJobsite,\n  deleteJobsite,\n} from \"../services/adminJobsiteService.js\";\n\n// GET /api/v1/admins/jobsite\nexport async function getAllJobsitesController(req: Request, res: Response) {\n  try {\n    const status = typeof req.query.status === \"string\" ? req.query.status : \"\";\n    const page = req.query.page ? parseInt(req.query.page as string, 10) : 1;\n    const pageSize = req.query.pageSize\n      ? parseInt(req.query.pageSize as string, 10)\n      : 25;\n    let skip = (page - 1) * pageSize;\n    let totalPages = 1;\n    let total = 0;\n    const result = await getAllJobsites(\n      status,\n      page,\n      pageSize,\n      skip,\n      totalPages,\n      total\n    );\n    res.status(200).json(result);\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Failed to fetch jobsites\",\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    });\n  }\n}\n\n// GET /api/v1/admins/jobsite/:id\nexport async function getJobsiteByIdController(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    if (!id) {\n      return res.status(400).json({\n        success: false,\n        message: \"Jobsite ID is required\",\n      });\n    }\n    const jobsite = await getJobsiteById(id);\n    if (!jobsite) {\n      return res.status(404).json({\n        success: false,\n        message: \"Jobsite not found\",\n      });\n    }\n    res.status(200).json(jobsite);\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Failed to fetch jobsite\",\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    });\n  }\n}\n\n// --- Types for Jobsite creation and update ---\nexport interface JobsiteCreateBody {\n  code: string;\n  name: string;\n  description: string;\n  ApprovalStatus: string;\n  status: string;\n  Address: {\n    street: string;\n    city: string;\n    state: string;\n    zipCode: string;\n  };\n  Client?: {\n    id: string;\n  } | null;\n  CCTags?: Array<{ id: string }>;\n  CreatedVia: string;\n  createdById: string;\n}\n\nexport interface JobsiteUpdateBody {\n  code?: string;\n  name?: string;\n  description?: string;\n  approvalStatus?: string;\n  status?: string;\n  creationReason?: string;\n  CCTags?: Array<{ id: string }>;\n  Address?: {\n    street: string;\n    city: string;\n    state: string;\n    zipCode: string;\n  };\n  updatedAt?: Date;\n  userId: string;\n}\n\n// POST /api/v1/admins/jobsite\nexport async function createJobsiteController(\n  req: Request<{}, {}, JobsiteCreateBody>,\n  res: Response\n) {\n  try {\n    const payload = req.body;\n    await createJobsite(payload);\n    res.status(201).json({\n      success: true,\n      message: \"Jobsite created successfully\",\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Failed to create jobsite\",\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    });\n  }\n}\n\n// PUT /api/v1/admins/jobsite/:id\nexport async function updateJobsiteController(\n  req: Request<{ id: string }, {}, JobsiteUpdateBody>,\n  res: Response\n) {\n  try {\n    const { id } = req.params;\n    if (!id) {\n      return res.status(400).json({\n        success: false,\n        message: \"Jobsite ID is required\",\n      });\n    }\n    const updateData = req.body;\n    // You may want to get userId from auth middleware/session\n    const updated = await updateJobsite(id, updateData);\n    res.status(200).json({\n      success: true,\n      message: \"Jobsite updated successfully\",\n      data: updated,\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Failed to update jobsite\",\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    });\n  }\n}\n\n// PUT /api/v1/admins/jobsite/:id/archive\nexport async function archiveJobsiteController(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    if (!id) {\n      return res.status(400).json({\n        success: false,\n        message: \"Jobsite ID is required\",\n      });\n    }\n\n    await archiveJobsite(id);\n    res.status(200).json({\n      success: true,\n      message: \"Jobsite archived successfully\",\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Failed to archive jobsite\",\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    });\n  }\n}\n\n// PUT /api/v1/admins/jobsite/:id/restore\nexport async function restoreJobsiteController(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    if (!id) {\n      return res.status(400).json({\n        success: false,\n        message: \"Jobsite ID is required\",\n      });\n    }\n    await restoreJobsite(id);\n\n    res.status(200).json({\n      success: true,\n      message: \"Jobsite restored successfully\",\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Failed to restore jobsite\",\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    });\n  }\n}\n\n// DELETE /api/v1/admins/jobsite/:id\nexport async function deleteJobsiteController(req: Request, res: Response) {\n  try {\n    const { id } = req.params;\n    if (!id) {\n      return res.status(400).json({\n        success: false,\n        message: \"Jobsite ID is required\",\n      });\n    }\n    await deleteJobsite(id);\n    res.status(200).json({\n      success: true,\n      message: \"Jobsite deleted successfully\",\n    });\n  } catch (error) {\n    res.status(500).json({\n      success: false,\n      message: \"Failed to delete jobsite\",\n      error: error instanceof Error ? error.message : \"Unknown error\",\n    });\n  }\n}\n"],"names":[],"mappings":"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","debug_id":"b16406a7-9da9-5579-bba6-a0466c43a51c"}