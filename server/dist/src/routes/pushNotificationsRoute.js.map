{"version":3,"file":"pushNotificationsRoute.js","sources":["src/routes/pushNotificationsRoute.ts"],"sourceRoot":"/","sourcesContent":["import { Router } from \"express\";\r\nimport type { Request, Response } from \"express\";\r\nimport { getFirebaseAdmin } from \"../lib/firebase.js\";\r\nimport NotificationService from \"../services/notificationService.js\";\r\nimport { markReadController } from \"../controllers/pushNotifcationController.js\";\r\nimport type { FirebaseError } from \"firebase-admin\";\r\n\r\nconst router = Router();\r\nconst admin = getFirebaseAdmin();\r\n\r\n/**\r\n * @swagger\r\n * /api/notifications/send:\r\n *   post:\r\n *     summary: Send a push notification to a user or topic\r\n *     tags: [Notifications]\r\n *     requestBody:\r\n *       required: true\r\n *       content:\r\n *         application/json:\r\n *           schema:\r\n *             type: object\r\n *             required:\r\n *               - title\r\n *               - body\r\n *             properties:\r\n *               title:\r\n *                 type: string\r\n *                 description: Notification title\r\n *               body:\r\n *                 type: string\r\n *                 description: Notification body\r\n *               deviceToken:\r\n *                 type: string\r\n *                 description: Device token for sending to specific device (optional)\r\n *               topic:\r\n *                 type: string\r\n *                 description: Topic name for sending to all subscribed devices (optional)\r\n *               data:\r\n *                 type: object\r\n *                 description: Custom data to send with notification\r\n *     responses:\r\n *       200:\r\n *         description: Notification sent successfully\r\n *       400:\r\n *         description: Either deviceToken or topic must be provided\r\n *       500:\r\n *         description: Failed to send notification\r\n */\r\n\r\nrouter.post(\"/send\", async (req: Request, res: Response) => {\r\n  try {\r\n    const { title, body, deviceToken, topic, data, url } = req.body;\r\n\r\n    if (!title || !body) {\r\n      return res.status(400).json({ error: \"Title and body are required\" });\r\n    }\r\n\r\n    if (!deviceToken && !topic) {\r\n      return res.status(400).json({\r\n        error: \"Either deviceToken or topic must be provided\",\r\n      });\r\n    }\r\n\r\n    const message: any = {\r\n      notification: { title, body },\r\n      ...(data && { data }),\r\n    };\r\n\r\n    let result;\r\n\r\n    if (deviceToken) {\r\n      // Send to specific device\r\n      message.token = deviceToken;\r\n      result = await admin.messaging().send(message);\r\n      console.log(\r\n        \"✅ Notification sent to device:\",\r\n        deviceToken,\r\n        \"Message ID:\",\r\n        result\r\n      );\r\n    } else if (topic) {\r\n      // Send to topic\r\n      message.topic = topic;\r\n      result = await admin.messaging().send(message);\r\n      console.log(\r\n        \"✅ Notification sent to topic:\",\r\n        topic,\r\n        \"Message ID:\",\r\n        result\r\n      );\r\n    }\r\n\r\n    // Create notification record in database\r\n    if (url) {\r\n      await NotificationService.createAndLinkNotification({\r\n        title,\r\n        body,\r\n        url,\r\n        topic: topic || null,\r\n      });\r\n    }\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      messageId: result,\r\n      message: \"Notification sent successfully\",\r\n    });\r\n  } catch (error) {\r\n    console.error(\"❌ Error sending notification:\", error);\r\n    const firebaseError = error as FirebaseError;\r\n    res.status(500).json({\r\n      error: \"Failed to send notification\",\r\n      message: firebaseError.message || String(error),\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * Send notification to multiple devices\r\n */\r\nrouter.post(\"/send-multicast\", async (req: Request, res: Response) => {\r\n  try {\r\n    const { title, body, deviceTokens, data, url } = req.body;\r\n\r\n    if (\r\n      !title ||\r\n      !body ||\r\n      !Array.isArray(deviceTokens) ||\r\n      deviceTokens.length === 0\r\n    ) {\r\n      return res.status(400).json({\r\n        error: \"Title, body, and array of deviceTokens are required\",\r\n      });\r\n    }\r\n\r\n    const message: any = {\r\n      notification: { title, body },\r\n      ...(data && { data }),\r\n    };\r\n\r\n    // Firebase Admin SDK uses sendAll for multicast (sendMulticast is not available)\r\n    // Send individual messages instead\r\n    const results = await Promise.all(\r\n      deviceTokens.map((token) =>\r\n        admin\r\n          .messaging()\r\n          .send({\r\n            ...message,\r\n            token,\r\n          })\r\n          .catch((err: FirebaseError) => ({ error: err }))\r\n      )\r\n    );\r\n\r\n    const successCount = results.filter((r: any) => !(\"error\" in r)).length;\r\n    const failureCount = results.filter((r: any) => \"error\" in r).length;\r\n\r\n    console.log(`✅ Multicast notification sent to ${successCount} devices`);\r\n    console.log(`⚠️ Failed to send to ${failureCount} devices`);\r\n\r\n    // Log failed tokens\r\n    if (failureCount > 0) {\r\n      results.forEach((result: any, index: number) => {\r\n        if (\"error\" in result) {\r\n          console.error(\r\n            `Failed token ${index}:`,\r\n            deviceTokens[index],\r\n            result.error\r\n          );\r\n        }\r\n      });\r\n    }\r\n\r\n    // Create notification record in database\r\n    if (url) {\r\n      await NotificationService.createAndLinkNotification({\r\n        title,\r\n        body,\r\n        url,\r\n      });\r\n    }\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      successCount,\r\n      failureCount,\r\n      message: \"Multicast notification sent\",\r\n    });\r\n  } catch (error) {\r\n    console.error(\"❌ Error sending multicast notification:\", error);\r\n    const firebaseError = error as FirebaseError;\r\n    res.status(500).json({\r\n      error: \"Failed to send multicast notification\",\r\n      message: firebaseError.message || String(error),\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * Subscribe device to topic\r\n */\r\nrouter.post(\"/subscribe-to-topic\", async (req: Request, res: Response) => {\r\n  try {\r\n    const { topic, deviceToken } = req.body;\r\n\r\n    if (!topic) {\r\n      return res.status(400).json({ error: \"Topic is required\" });\r\n    }\r\n\r\n    // If deviceToken is provided, subscribe specific device\r\n    if (deviceToken) {\r\n      await admin.messaging().subscribeToTopic(deviceToken, topic);\r\n      console.log(`✅ Device subscribed to topic: ${topic}`);\r\n    }\r\n\r\n    // Create topic subscription record in database\r\n    // Note: This assumes you have userId in the request context\r\n    // Adjust as needed for your auth implementation\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: `Successfully subscribed to topic: ${topic}`,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"❌ Error subscribing to topic:\", error);\r\n    const firebaseError = error as FirebaseError;\r\n    res.status(500).json({\r\n      error: \"Failed to subscribe to topic\",\r\n      message: firebaseError.message || String(error),\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * Unsubscribe device from topic\r\n */\r\nrouter.post(\"/unsubscribe-from-topic\", async (req: Request, res: Response) => {\r\n  try {\r\n    const { topic, deviceToken } = req.body;\r\n\r\n    if (!topic) {\r\n      return res.status(400).json({ error: \"Topic is required\" });\r\n    }\r\n\r\n    // If deviceToken is provided, unsubscribe specific device\r\n    if (deviceToken) {\r\n      await admin.messaging().unsubscribeFromTopic(deviceToken, topic);\r\n      console.log(`✅ Device unsubscribed from topic: ${topic}`);\r\n    }\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: `Successfully unsubscribed from topic: ${topic}`,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"❌ Error unsubscribing from topic:\", error);\r\n    const firebaseError = error as FirebaseError;\r\n    res.status(500).json({\r\n      error: \"Failed to unsubscribe from topic\",\r\n      message: firebaseError.message || String(error),\r\n    });\r\n  }\r\n});\r\n\r\n/**\r\n * Subscribe multiple devices to topic\r\n */\r\nrouter.post(\r\n  \"/subscribe-devices-to-topic\",\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const { topic, deviceTokens } = req.body;\r\n\r\n      if (!topic || !Array.isArray(deviceTokens) || deviceTokens.length === 0) {\r\n        return res.status(400).json({\r\n          error: \"Topic and array of deviceTokens are required\",\r\n        });\r\n      }\r\n\r\n      await admin.messaging().subscribeToTopic(deviceTokens, topic);\r\n      console.log(\r\n        `✅ ${deviceTokens.length} devices subscribed to topic: ${topic}`\r\n      );\r\n\r\n      res.status(200).json({\r\n        success: true,\r\n        subscribedCount: deviceTokens.length,\r\n        message: `Successfully subscribed ${deviceTokens.length} devices to topic: ${topic}`,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"❌ Error subscribing devices to topic:\", error);\r\n      const firebaseError = error as FirebaseError;\r\n      res.status(500).json({\r\n        error: \"Failed to subscribe devices to topic\",\r\n        message: firebaseError.message || String(error),\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\n/**\r\n * Unsubscribe multiple devices from topic\r\n */\r\nrouter.post(\r\n  \"/unsubscribe-devices-from-topic\",\r\n  async (req: Request, res: Response) => {\r\n    try {\r\n      const { topic, deviceTokens } = req.body;\r\n\r\n      if (!topic || !Array.isArray(deviceTokens) || deviceTokens.length === 0) {\r\n        return res.status(400).json({\r\n          error: \"Topic and array of deviceTokens are required\",\r\n        });\r\n      }\r\n\r\n      await admin.messaging().unsubscribeFromTopic(deviceTokens, topic);\r\n      console.log(\r\n        `✅ ${deviceTokens.length} devices unsubscribed from topic: ${topic}`\r\n      );\r\n\r\n      res.status(200).json({\r\n        success: true,\r\n        unsubscribedCount: deviceTokens.length,\r\n        message: `Successfully unsubscribed ${deviceTokens.length} devices from topic: ${topic}`,\r\n      });\r\n    } catch (error) {\r\n      console.error(\"❌ Error unsubscribing devices from topic:\", error);\r\n      const firebaseError = error as FirebaseError;\r\n      res.status(500).json({\r\n        error: \"Failed to unsubscribe devices from topic\",\r\n        message: firebaseError.message || String(error),\r\n      });\r\n    }\r\n  }\r\n);\r\n\r\nrouter.post(\"/mark-read\", markReadController);\r\n\r\nexport default router;\r\n"],"names":[],"mappings":"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","debug_id":"215f7981-d9ba-5c77-a081-103727db81ec"}