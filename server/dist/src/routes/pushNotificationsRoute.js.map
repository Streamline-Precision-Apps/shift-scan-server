{"version":3,"file":"pushNotificationsRoute.js","sources":["src/routes/pushNotificationsRoute.ts"],"sourceRoot":"/","sourcesContent":["import { Router } from \"express\";\nimport type { Request, Response } from \"express\";\nimport { getFirebaseAdmin } from \"../lib/firebase.js\";\nimport NotificationService from \"../services/notificationService.js\";\nimport { markReadController } from \"../controllers/pushNotifcationController.js\";\nimport type { FirebaseError } from \"firebase-admin\";\n\nconst router = Router();\nconst admin = getFirebaseAdmin();\n\n/**\n * @swagger\n * /api/notifications/send:\n *   post:\n *     summary: Send a push notification to a user or topic\n *     tags: [Notifications]\n *     requestBody:\n *       required: true\n *       content:\n *         application/json:\n *           schema:\n *             type: object\n *             required:\n *               - title\n *               - body\n *             properties:\n *               title:\n *                 type: string\n *                 description: Notification title\n *               body:\n *                 type: string\n *                 description: Notification body\n *               deviceToken:\n *                 type: string\n *                 description: Device token for sending to specific device (optional)\n *               topic:\n *                 type: string\n *                 description: Topic name for sending to all subscribed devices (optional)\n *               data:\n *                 type: object\n *                 description: Custom data to send with notification\n *     responses:\n *       200:\n *         description: Notification sent successfully\n *       400:\n *         description: Either deviceToken or topic must be provided\n *       500:\n *         description: Failed to send notification\n */\n\nrouter.post(\"/send\", async (req: Request, res: Response) => {\n  try {\n    const { title, body, deviceToken, topic, data, url } = req.body;\n\n    if (!title || !body) {\n      return res.status(400).json({ error: \"Title and body are required\" });\n    }\n\n    if (!deviceToken && !topic) {\n      return res.status(400).json({\n        error: \"Either deviceToken or topic must be provided\",\n      });\n    }\n\n    const message: any = {\n      notification: { title, body },\n      ...(data && { data }),\n    };\n\n    let result;\n\n    if (deviceToken) {\n      // Send to specific device\n      message.token = deviceToken;\n      result = await admin.messaging().send(message);\n      console.log(\n        \"✅ Notification sent to device:\",\n        deviceToken,\n        \"Message ID:\",\n        result\n      );\n    } else if (topic) {\n      // Send to topic\n      message.topic = topic;\n      result = await admin.messaging().send(message);\n      console.log(\n        \"✅ Notification sent to topic:\",\n        topic,\n        \"Message ID:\",\n        result\n      );\n    }\n\n    // Create notification record in database\n    if (url) {\n      await NotificationService.createAndLinkNotification({\n        title,\n        body,\n        url,\n        topic: topic || null,\n      });\n    }\n\n    res.status(200).json({\n      success: true,\n      messageId: result,\n      message: \"Notification sent successfully\",\n    });\n  } catch (error) {\n    console.error(\"❌ Error sending notification:\", error);\n    const firebaseError = error as FirebaseError;\n    res.status(500).json({\n      error: \"Failed to send notification\",\n      message: firebaseError.message || String(error),\n    });\n  }\n});\n\n/**\n * Send notification to multiple devices\n */\nrouter.post(\"/send-multicast\", async (req: Request, res: Response) => {\n  try {\n    const { title, body, deviceTokens, data, url } = req.body;\n\n    if (\n      !title ||\n      !body ||\n      !Array.isArray(deviceTokens) ||\n      deviceTokens.length === 0\n    ) {\n      return res.status(400).json({\n        error: \"Title, body, and array of deviceTokens are required\",\n      });\n    }\n\n    const message: any = {\n      notification: { title, body },\n      ...(data && { data }),\n    };\n\n    // Firebase Admin SDK uses sendAll for multicast (sendMulticast is not available)\n    // Send individual messages instead\n    const results = await Promise.all(\n      deviceTokens.map((token) =>\n        admin\n          .messaging()\n          .send({\n            ...message,\n            token,\n          })\n          .catch((err: FirebaseError) => ({ error: err }))\n      )\n    );\n\n    const successCount = results.filter((r: any) => !(\"error\" in r)).length;\n    const failureCount = results.filter((r: any) => \"error\" in r).length;\n\n    console.log(`✅ Multicast notification sent to ${successCount} devices`);\n    console.log(`⚠️ Failed to send to ${failureCount} devices`);\n\n    // Log failed tokens\n    if (failureCount > 0) {\n      results.forEach((result: any, index: number) => {\n        if (\"error\" in result) {\n          console.error(\n            `Failed token ${index}:`,\n            deviceTokens[index],\n            result.error\n          );\n        }\n      });\n    }\n\n    // Create notification record in database\n    if (url) {\n      await NotificationService.createAndLinkNotification({\n        title,\n        body,\n        url,\n      });\n    }\n\n    res.status(200).json({\n      success: true,\n      successCount,\n      failureCount,\n      message: \"Multicast notification sent\",\n    });\n  } catch (error) {\n    console.error(\"❌ Error sending multicast notification:\", error);\n    const firebaseError = error as FirebaseError;\n    res.status(500).json({\n      error: \"Failed to send multicast notification\",\n      message: firebaseError.message || String(error),\n    });\n  }\n});\n\n/**\n * Subscribe device to topic\n */\nrouter.post(\"/subscribe-to-topic\", async (req: Request, res: Response) => {\n  try {\n    const { topic, deviceToken } = req.body;\n\n    if (!topic) {\n      return res.status(400).json({ error: \"Topic is required\" });\n    }\n\n    // If deviceToken is provided, subscribe specific device\n    if (deviceToken) {\n      await admin.messaging().subscribeToTopic(deviceToken, topic);\n      console.log(`✅ Device subscribed to topic: ${topic}`);\n    }\n\n    // Create topic subscription record in database\n    // Note: This assumes you have userId in the request context\n    // Adjust as needed for your auth implementation\n\n    res.status(200).json({\n      success: true,\n      message: `Successfully subscribed to topic: ${topic}`,\n    });\n  } catch (error) {\n    console.error(\"❌ Error subscribing to topic:\", error);\n    const firebaseError = error as FirebaseError;\n    res.status(500).json({\n      error: \"Failed to subscribe to topic\",\n      message: firebaseError.message || String(error),\n    });\n  }\n});\n\n/**\n * Unsubscribe device from topic\n */\nrouter.post(\"/unsubscribe-from-topic\", async (req: Request, res: Response) => {\n  try {\n    const { topic, deviceToken } = req.body;\n\n    if (!topic) {\n      return res.status(400).json({ error: \"Topic is required\" });\n    }\n\n    // If deviceToken is provided, unsubscribe specific device\n    if (deviceToken) {\n      await admin.messaging().unsubscribeFromTopic(deviceToken, topic);\n      console.log(`✅ Device unsubscribed from topic: ${topic}`);\n    }\n\n    res.status(200).json({\n      success: true,\n      message: `Successfully unsubscribed from topic: ${topic}`,\n    });\n  } catch (error) {\n    console.error(\"❌ Error unsubscribing from topic:\", error);\n    const firebaseError = error as FirebaseError;\n    res.status(500).json({\n      error: \"Failed to unsubscribe from topic\",\n      message: firebaseError.message || String(error),\n    });\n  }\n});\n\n/**\n * Subscribe multiple devices to topic\n */\nrouter.post(\n  \"/subscribe-devices-to-topic\",\n  async (req: Request, res: Response) => {\n    try {\n      const { topic, deviceTokens } = req.body;\n\n      if (!topic || !Array.isArray(deviceTokens) || deviceTokens.length === 0) {\n        return res.status(400).json({\n          error: \"Topic and array of deviceTokens are required\",\n        });\n      }\n\n      await admin.messaging().subscribeToTopic(deviceTokens, topic);\n      console.log(\n        `✅ ${deviceTokens.length} devices subscribed to topic: ${topic}`\n      );\n\n      res.status(200).json({\n        success: true,\n        subscribedCount: deviceTokens.length,\n        message: `Successfully subscribed ${deviceTokens.length} devices to topic: ${topic}`,\n      });\n    } catch (error) {\n      console.error(\"❌ Error subscribing devices to topic:\", error);\n      const firebaseError = error as FirebaseError;\n      res.status(500).json({\n        error: \"Failed to subscribe devices to topic\",\n        message: firebaseError.message || String(error),\n      });\n    }\n  }\n);\n\n/**\n * Unsubscribe multiple devices from topic\n */\nrouter.post(\n  \"/unsubscribe-devices-from-topic\",\n  async (req: Request, res: Response) => {\n    try {\n      const { topic, deviceTokens } = req.body;\n\n      if (!topic || !Array.isArray(deviceTokens) || deviceTokens.length === 0) {\n        return res.status(400).json({\n          error: \"Topic and array of deviceTokens are required\",\n        });\n      }\n\n      await admin.messaging().unsubscribeFromTopic(deviceTokens, topic);\n      console.log(\n        `✅ ${deviceTokens.length} devices unsubscribed from topic: ${topic}`\n      );\n\n      res.status(200).json({\n        success: true,\n        unsubscribedCount: deviceTokens.length,\n        message: `Successfully unsubscribed ${deviceTokens.length} devices from topic: ${topic}`,\n      });\n    } catch (error) {\n      console.error(\"❌ Error unsubscribing devices from topic:\", error);\n      const firebaseError = error as FirebaseError;\n      res.status(500).json({\n        error: \"Failed to unsubscribe devices from topic\",\n        message: firebaseError.message || String(error),\n      });\n    }\n  }\n);\n\nrouter.post(\"/mark-read\", markReadController);\n\nexport default router;\n"],"names":[],"mappings":"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","debug_id":"b7d49823-2553-5687-a6ba-1a185464edda"}