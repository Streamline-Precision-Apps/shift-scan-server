{"version":3,"file":"notificationsRoute.js","sources":["src/routes/notificationsRoute.ts"],"sourceRoot":"/","sourcesContent":["import { Router } from \"express\";\r\nimport { verifyToken } from \"../middleware/authMiddleware.js\";\r\nimport {\r\n  sendNotification,\r\n  sendNotificationMulticast,\r\n  topics,\r\n} from \"../controllers/notificationController.js\";\r\nimport { requireFirebaseEnv } from \"../middleware/requireFirebaseEnv.js\";\r\n\r\nconst router = Router();\r\n\r\n\r\n/**\r\n * @swagger\r\n * /api/notifications/send-multicast:\r\n *   post:\r\n *     tags:\r\n *       - Notifications\r\n *     summary: Send notification to a topic (multicast)\r\n *     description: Send a notification to all users subscribed to a topic. Stores the notification in the database.\r\n *     security:\r\n *       - bearerAuth: []\r\n *     requestBody:\r\n *       required: true\r\n *       content:\r\n *         application/json:\r\n *           schema:\r\n *             type: object\r\n *             properties:\r\n *               topic:\r\n *                 type: string\r\n *               title:\r\n *                 type: string\r\n *               message:\r\n *                 type: string\r\n *               link:\r\n *                 type: string\r\n *               referenceId:\r\n *                 type: string\r\n *     responses:\r\n *       200:\r\n *         description: Notification sent successfully\r\n *         content:\r\n *           application/json:\r\n *             schema:\r\n *               type: object\r\n *               properties:\r\n *                 messageId:\r\n *                   type: string\r\n *                 success:\r\n *                   type: boolean\r\n *                 sentToTopic:\r\n *                   type: string\r\n *       400:\r\n *         description: Bad request\r\n *       401:\r\n *         description: Unauthorized\r\n *       500:\r\n *         description: Server error\r\n */\r\nrouter.post(\r\n  \"/send-multicast\",\r\n  verifyToken,\r\n  requireFirebaseEnv,\r\n  sendNotificationMulticast\r\n);\r\n\r\n/**\r\n * @swagger\r\n * /api/notifications/send-notification:\r\n *   post:\r\n *     tags:\r\n *       - Notifications\r\n *     summary: Send notification to a device\r\n *     description: Send a notification to a specific device token. Stores the notification in the database.\r\n *     security:\r\n *       - bearerAuth: []\r\n *     requestBody:\r\n *       required: true\r\n *       content:\r\n *         application/json:\r\n *           schema:\r\n *             type: object\r\n *             properties:\r\n *               token:\r\n *                 type: string\r\n *               title:\r\n *                 type: string\r\n *               message:\r\n *                 type: string\r\n *               link:\r\n *                 type: string\r\n *               topic:\r\n *                 type: string\r\n *     responses:\r\n *       200:\r\n *         description: Notification sent successfully\r\n *         content:\r\n *           application/json:\r\n *             schema:\r\n *               type: object\r\n *               properties:\r\n *                 success:\r\n *                   type: boolean\r\n *                 message:\r\n *                   type: string\r\n *       400:\r\n *         description: Bad request\r\n *       401:\r\n *         description: Unauthorized\r\n *       500:\r\n *         description: Server error\r\n */\r\nrouter.post(\r\n  \"/send-notification\",\r\n  verifyToken,\r\n  requireFirebaseEnv,\r\n  sendNotification\r\n);\r\n\r\n/**\r\n * @swagger\r\n * /api/notifications/topics:\r\n *   post:\r\n *     tags:\r\n *       - Notifications\r\n *     summary: Subscribe or unsubscribe device to topics\r\n *     description: Subscribe or unsubscribe a device token to one or more topics. Optionally records topic subscriptions in the database.\r\n *     security:\r\n *       - bearerAuth: []\r\n *     requestBody:\r\n *       required: true\r\n *       content:\r\n *         application/json:\r\n *           schema:\r\n *             type: object\r\n *             properties:\r\n *               action:\r\n *                 type: string\r\n *                 enum: [subscribe, unsubscribe]\r\n *               topics:\r\n *                 type: array\r\n *                 items:\r\n *                   type: string\r\n *               token:\r\n *                 type: string\r\n *               userId:\r\n *                 type: string\r\n *     responses:\r\n *       200:\r\n *         description: Topics processed successfully\r\n *         content:\r\n *           application/json:\r\n *             schema:\r\n *               type: object\r\n *               properties:\r\n *                 success:\r\n *                   type: boolean\r\n *                 message:\r\n *                   type: string\r\n *                 results:\r\n *                   type: array\r\n *                   items:\r\n *                     type: object\r\n *                     properties:\r\n *                       topic:\r\n *                         type: string\r\n *                       success:\r\n *                         type: boolean\r\n *                       failureCount:\r\n *                         type: integer\r\n *       400:\r\n *         description: Bad request\r\n *       401:\r\n *         description: Unauthorized\r\n *       500:\r\n *         description: Server error\r\n */\r\nrouter.post(\"/topics\", verifyToken, requireFirebaseEnv, topics);\r\n\r\nexport default router;\r\n"],"names":[],"mappings":";;AAAA,OAAO,EAAE,MAAM,EAAE,MAAM,SAAS,CAAC;AACjC,OAAO,EAAE,WAAW,EAAE,MAAM,iCAAiC,CAAC;AAC9D,OAAO,EACL,gBAAgB,EAChB,yBAAyB,EACzB,MAAM,GACP,MAAM,0CAA0C,CAAC;AAClD,OAAO,EAAE,kBAAkB,EAAE,MAAM,qCAAqC,CAAC;AAEzE,MAAM,MAAM,GAAG,MAAM,EAAE,CAAC;AAGxB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA+CG;AACH,MAAM,CAAC,IAAI,CACT,iBAAiB,EACjB,WAAW,EACX,kBAAkB,EAClB,yBAAyB,CAC1B,CAAC;AAEF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA6CG;AACH,MAAM,CAAC,IAAI,CACT,oBAAoB,EACpB,WAAW,EACX,kBAAkB,EAClB,gBAAgB,CACjB,CAAC;AAEF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAyDG;AACH,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,WAAW,EAAE,kBAAkB,EAAE,MAAM,CAAC,CAAC;AAEhE,eAAe,MAAM,CAAC","debug_id":"b9f643fb-93a5-5fe1-b358-785adc0112a9"}