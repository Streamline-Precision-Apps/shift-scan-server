{"version":3,"file":"locationService.js","sources":["src/services/locationService.ts"],"sourceRoot":"/","sourcesContent":["import prisma from \"../lib/prisma.js\";\r\nimport type { Location } from \"../types/Location.js\";\r\n\r\n// Helper function to get start and end of day in user's local timezone\r\nfunction getDayRange(date: Date = new Date()) {\r\n  // Parse ISO string and create date in local timezone\r\n  const isoString = date.toISOString();\r\n  const dateStr = isoString.split(\"T\")[0] || \"2025-01-01\";\r\n  const parts = dateStr.split(\"-\");\r\n  const year = parseInt(parts[0]!);\r\n  const month = parseInt(parts[1]!);\r\n  const day = parseInt(parts[2]!);\r\n\r\n  const startOfDay = new Date(year, month - 1, day, 0, 0, 0, 0);\r\n  const endOfDay = new Date(year, month - 1, day, 23, 59, 59, 999);\r\n\r\n  return { startOfDay, endOfDay };\r\n}\r\n\r\nexport async function fetchLatestLocation(\r\n  userId: string,\r\n  date: Date = new Date()\r\n): Promise<Location | null> {\r\n  const { startOfDay, endOfDay } = getDayRange(date);\r\n\r\n  const marker = await prisma.locationMarker.findFirst({\r\n    where: {\r\n      Session: {\r\n        userId,\r\n      },\r\n      createdAt: {\r\n        gte: startOfDay,\r\n        lte: endOfDay,\r\n      },\r\n    },\r\n    orderBy: {\r\n      createdAt: \"desc\",\r\n    },\r\n  });\r\n\r\n  if (!marker) {\r\n    console.warn(`[Location] No location found for user ${userId}`);\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    uid: userId,\r\n    ts: marker.createdAt,\r\n    coords: {\r\n      lat: marker.lat,\r\n      lng: marker.long,\r\n      accuracy: marker.accuracy,\r\n      speed: marker.speed,\r\n      heading: marker.heading,\r\n    },\r\n    device: {},\r\n  };\r\n}\r\n\r\nexport async function fetchLocationHistory(\r\n  userId: string,\r\n  date: Date = new Date()\r\n): Promise<Location[]> {\r\n  const { startOfDay, endOfDay } = getDayRange(date);\r\n\r\n  const markers = await prisma.locationMarker.findMany({\r\n    where: {\r\n      Session: {\r\n        userId,\r\n      },\r\n      createdAt: {\r\n        gte: startOfDay,\r\n        lte: endOfDay,\r\n      },\r\n    },\r\n    orderBy: {\r\n      createdAt: \"desc\",\r\n    },\r\n  });\r\n\r\n  let locations = markers.map((marker) => ({\r\n    uid: userId,\r\n    ts: marker.createdAt,\r\n    coords: {\r\n      lat: marker.lat,\r\n      lng: marker.long,\r\n      accuracy: marker.accuracy,\r\n      speed: marker.speed,\r\n      heading: marker.heading,\r\n    },\r\n    device: {},\r\n  }));\r\n\r\n  // Add fake history for Emily Wilson (test-user-4)\r\n  if (userId === \"test-user-4\") {\r\n    const baseTime = new Date();\r\n    const fakeHistory = [\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 3600000), // 1 hour ago\r\n        coords: {\r\n          lat: 42.5395,\r\n          lng: -113.782,\r\n          accuracy: 5,\r\n          speed: 0,\r\n          heading: 0,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 3300000), // 55 min ago\r\n        coords: {\r\n          lat: 42.5397,\r\n          lng: -113.7825,\r\n          accuracy: 6,\r\n          speed: 1.2,\r\n          heading: 45,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 3000000), // 50 min ago\r\n        coords: {\r\n          lat: 42.54,\r\n          lng: -113.783,\r\n          accuracy: 5,\r\n          speed: 1.5,\r\n          heading: 90,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 2700000), // 45 min ago\r\n        coords: {\r\n          lat: 42.5402,\r\n          lng: -113.7835,\r\n          accuracy: 7,\r\n          speed: 2.0,\r\n          heading: 45,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 2400000), // 40 min ago\r\n        coords: {\r\n          lat: 42.5405,\r\n          lng: -113.784,\r\n          accuracy: 6,\r\n          speed: 1.8,\r\n          heading: 0,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 2100000), // 35 min ago\r\n        coords: {\r\n          lat: 42.5408,\r\n          lng: -113.7838,\r\n          accuracy: 5,\r\n          speed: 1.2,\r\n          heading: 315,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 1800000), // 30 min ago\r\n        coords: {\r\n          lat: 42.541,\r\n          lng: -113.7833,\r\n          accuracy: 8,\r\n          speed: 0.5,\r\n          heading: 270,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 1500000), // 25 min ago\r\n        coords: {\r\n          lat: 42.5408,\r\n          lng: -113.7828,\r\n          accuracy: 6,\r\n          speed: 1.0,\r\n          heading: 180,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 1200000), // 20 min ago\r\n        coords: {\r\n          lat: 42.5405,\r\n          lng: -113.7822,\r\n          accuracy: 5,\r\n          speed: 1.5,\r\n          heading: 225,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 900000), // 15 min ago\r\n        coords: {\r\n          lat: 42.54,\r\n          lng: -113.7815,\r\n          accuracy: 7,\r\n          speed: 2.0,\r\n          heading: 270,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 600000), // 10 min ago\r\n        coords: {\r\n          lat: 42.5397,\r\n          lng: -113.781,\r\n          accuracy: 6,\r\n          speed: 1.8,\r\n          heading: 225,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: new Date(baseTime.getTime() - 300000), // 5 min ago\r\n        coords: {\r\n          lat: 42.5393,\r\n          lng: -113.7818,\r\n          accuracy: 5,\r\n          speed: 1.2,\r\n          heading: 90,\r\n        },\r\n        device: {},\r\n      },\r\n      {\r\n        uid: userId,\r\n        ts: baseTime, // now\r\n        coords: {\r\n          lat: 42.5393,\r\n          lng: -113.7823,\r\n          accuracy: 5,\r\n          speed: 0,\r\n          heading: 0,\r\n        },\r\n        device: {},\r\n      },\r\n    ];\r\n    locations = [...fakeHistory, ...locations];\r\n  }\r\n\r\n  return locations;\r\n}\r\n\r\nexport async function fetchAllUsersLatestLocations(\r\n  date: Date = new Date()\r\n): Promise<\r\n  Array<{\r\n    userId: string;\r\n    location: Location;\r\n    userName?: string;\r\n    profilePicture?: string | undefined;\r\n    phoneNumber?: string | undefined;\r\n    startTime?: string;\r\n    endTime?: string;\r\n  }>\r\n> {\r\n  try {\r\n    const { startOfDay, endOfDay } = getDayRange(date);\r\n\r\n    // Get all unique users who have location markers on the specified day\r\n    const sessions = await prisma.session.findMany({\r\n      distinct: [\"userId\"],\r\n      orderBy: {\r\n        startTime: \"desc\",\r\n      },\r\n\r\n      include: {\r\n        User: {\r\n          select: {\r\n            id: true,\r\n            firstName: true,\r\n            lastName: true,\r\n            image: true,\r\n            Contact: {\r\n              select: { phoneNumber: true },\r\n            },\r\n          },\r\n        },\r\n        locationMarkers: {\r\n          where: {\r\n            createdAt: {\r\n              gte: startOfDay,\r\n              lte: endOfDay,\r\n            },\r\n          },\r\n          orderBy: {\r\n            createdAt: \"desc\",\r\n          },\r\n          take: 1,\r\n        },\r\n      },\r\n    });\r\n\r\n    const allLocations: Array<{\r\n      userId: string;\r\n      location: Location;\r\n      userName?: string;\r\n      profilePicture?: string | undefined;\r\n      phoneNumber?: string | undefined;\r\n      startTime?: string;\r\n      endTime?: string;\r\n    }> = [];\r\n\r\n    for (const session of sessions) {\r\n      if (session.locationMarkers.length > 0) {\r\n        const marker = session.locationMarkers[0]!;\r\n        const userName = session.User\r\n          ? `${session.User.firstName} ${session.User.lastName || \"\"}`.trim()\r\n          : session.userId;\r\n\r\n        allLocations.push({\r\n          userId: session.userId,\r\n          location: {\r\n            uid: session.userId,\r\n            ts: marker.createdAt,\r\n            coords: {\r\n              lat: marker.lat,\r\n              lng: marker.long,\r\n              accuracy: marker.accuracy,\r\n              speed: marker.speed,\r\n              heading: marker.heading,\r\n            },\r\n            device: {},\r\n          },\r\n          userName,\r\n          profilePicture: session.User?.image || undefined,\r\n          phoneNumber: session.User?.Contact?.phoneNumber || undefined,\r\n          ...(session.startTime && {\r\n            startTime: session.startTime.toISOString(),\r\n          }),\r\n          ...(session.endTime && { endTime: session.endTime.toISOString() }),\r\n        });\r\n      }\r\n    }\r\n\r\n    // Append fake test users for development\r\n    const fakeUsers = [\r\n      {\r\n        userId: \"test-user-1\",\r\n        location: {\r\n          uid: \"test-user-1\",\r\n          ts: new Date(),\r\n          coords: {\r\n            lat: 42.5392,\r\n            lng: -113.7822,\r\n            accuracy: 5,\r\n            speed: 0,\r\n            heading: 0,\r\n          },\r\n          device: {},\r\n        },\r\n        userName: \"John Smith\",\r\n        profilePicture: \"https://api.dicebear.com/7.x/avataaars/svg?seed=John\",\r\n        phoneNumber: \"(208) 555-0101\",\r\n        startTime: new Date(Date.now() - 8 * 60 * 60 * 1000).toISOString(), // 8 hours ago\r\n        endTime: new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString(), // 1 hour from now\r\n      },\r\n      {\r\n        userId: \"test-user-2\",\r\n        location: {\r\n          uid: \"test-user-2\",\r\n          ts: new Date(),\r\n          coords: {\r\n            lat: 42.53925,\r\n            lng: -113.78225,\r\n            accuracy: 8,\r\n            speed: 2,\r\n            heading: 90,\r\n          },\r\n          device: {},\r\n        },\r\n        userName: \"Sarah Johnson\",\r\n        profilePicture: \"https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah\",\r\n        phoneNumber: \"(208) 555-0102\",\r\n        startTime: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString(), // 6 hours ago\r\n        endTime: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(), // 2 hours from now\r\n      },\r\n      {\r\n        userId: \"test-user-3\",\r\n        location: {\r\n          uid: \"test-user-3\",\r\n          ts: new Date(),\r\n          coords: {\r\n            lat: 42.53915,\r\n            lng: -113.78215,\r\n            accuracy: 6,\r\n            speed: 1.5,\r\n            heading: 180,\r\n          },\r\n          device: {},\r\n        },\r\n        userName: \"Mike Davis\",\r\n        profilePicture: \"https://api.dicebear.com/7.x/avataaars/svg?seed=Mike\",\r\n        phoneNumber: \"(208) 555-0103\",\r\n        startTime: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(), // 4 hours ago\r\n        endTime: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(), // 4 hours from now\r\n      },\r\n      {\r\n        userId: \"test-user-4\",\r\n        location: {\r\n          uid: \"test-user-4\",\r\n          ts: new Date(),\r\n          coords: {\r\n            lat: 42.53935,\r\n            lng: -113.78235,\r\n            accuracy: 7,\r\n            speed: 3,\r\n            heading: 45,\r\n          },\r\n          device: {},\r\n        },\r\n        userName: \"Emily Wilson\",\r\n        profilePicture: \"https://api.dicebear.com/7.x/avataaars/svg?seed=Emily\",\r\n        phoneNumber: \"(208) 555-0104\",\r\n        startTime: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(), // 5 hours ago\r\n        endTime: new Date(Date.now() + 3 * 60 * 60 * 1000).toISOString(), // 3 hours from now\r\n      },\r\n      {\r\n        userId: \"test-user-5\",\r\n        location: {\r\n          uid: \"test-user-5\",\r\n          ts: new Date(),\r\n          coords: {\r\n            lat: 42.539,\r\n            lng: -113.782,\r\n            accuracy: 9,\r\n            speed: 0.5,\r\n            heading: 270,\r\n          },\r\n          device: {},\r\n        },\r\n        userName: \"Robert Brown\",\r\n        profilePicture:\r\n          \"https://api.dicebear.com/7.x/avataaars/svg?seed=Robert\",\r\n        phoneNumber: \"(208) 555-0105\",\r\n        startTime: new Date(Date.now() - 7 * 60 * 60 * 1000).toISOString(), // 7 hours ago\r\n        endTime: new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString(), // 1 hour from now\r\n      },\r\n    ];\r\n\r\n    allLocations.push(...fakeUsers);\r\n\r\n    return allLocations;\r\n  } catch (err) {\r\n    console.error(\"Error fetching all users locations:\", err);\r\n    return [];\r\n  }\r\n}\r\n\r\nexport function validateLocationPayload(\r\n  payload: Partial<Location>\r\n): string | null {\r\n  if (\r\n    !payload.coords ||\r\n    typeof payload.coords.lat !== \"number\" ||\r\n    typeof payload.coords.lng !== \"number\"\r\n  ) {\r\n    return \"Missing or invalid coordinates\";\r\n  }\r\n  return null;\r\n}\r\n\r\nexport async function saveUserClockInLocation(\r\n  userId: string,\r\n  sessionId: number,\r\n  coords: Location[\"coords\"],\r\n  device?: Location[\"device\"]\r\n): Promise<boolean> {\r\n  try {\r\n    await prisma.locationMarker.create({\r\n      data: {\r\n        sessionId,\r\n        lat: coords.lat,\r\n        long: coords.lng,\r\n        accuracy: coords.accuracy ?? null,\r\n        speed: coords.speed ?? null,\r\n        heading: coords.heading ?? null,\r\n      },\r\n    });\r\n    return true;\r\n  } catch (err) {\r\n    console.error(\"Error saving location marker:\", err);\r\n    throw err;\r\n  }\r\n}\r\nexport async function saveUserClockOutLocation(\r\n  userId: string,\r\n  sessionId: number,\r\n  coords?: Location[\"coords\"],\r\n  device?: Location[\"device\"]\r\n): Promise<boolean> {\r\n  try {\r\n    await prisma.$transaction(async (tx) => {\r\n      await tx.session.update({\r\n        where: {\r\n          id: sessionId,\r\n        },\r\n        data: {\r\n          endTime: new Date(),\r\n        },\r\n      });\r\n    });\r\n    return true;\r\n  } catch (err) {\r\n    console.error(\"Error saving location marker:\", err);\r\n    throw err;\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debug_id":"d3ecd104-01b2-53da-8833-1e630911e2ba"}