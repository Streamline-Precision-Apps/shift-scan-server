{"version":3,"file":"locationService.js","sources":["src/services/locationService.ts"],"sourceRoot":"/","sourcesContent":["import prisma from \"../lib/prisma.js\";\nimport type { Location } from \"../types/Location.js\";\n\n// Helper function to get start and end of day in user's local timezone\nfunction getDayRange(date: Date = new Date()) {\n  // Parse ISO string and create date in local timezone\n  const isoString = date.toISOString();\n  const dateStr = isoString.split(\"T\")[0] || \"2025-01-01\";\n  const parts = dateStr.split(\"-\");\n  const year = parseInt(parts[0]!);\n  const month = parseInt(parts[1]!);\n  const day = parseInt(parts[2]!);\n\n  const startOfDay = new Date(year, month - 1, day, 0, 0, 0, 0);\n  const endOfDay = new Date(year, month - 1, day, 23, 59, 59, 999);\n\n  return { startOfDay, endOfDay };\n}\n\nexport async function fetchLatestLocation(\n  userId: string,\n  date: Date = new Date()\n): Promise<Location | null> {\n  const { startOfDay, endOfDay } = getDayRange(date);\n\n  const marker = await prisma.locationMarker.findFirst({\n    where: {\n      Session: {\n        userId,\n      },\n      createdAt: {\n        gte: startOfDay,\n        lte: endOfDay,\n      },\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  if (!marker) {\n    console.warn(`[Location] No location found for user ${userId}`);\n    return null;\n  }\n\n  return {\n    uid: userId,\n    ts: marker.createdAt,\n    coords: {\n      lat: marker.lat,\n      lng: marker.long,\n      accuracy: marker.accuracy,\n      speed: marker.speed,\n      heading: marker.heading,\n    },\n    device: {},\n  };\n}\n\nexport async function fetchLocationHistory(\n  userId: string,\n  date: Date = new Date()\n): Promise<Location[]> {\n  const { startOfDay, endOfDay } = getDayRange(date);\n\n  const markers = await prisma.locationMarker.findMany({\n    where: {\n      Session: {\n        userId,\n      },\n      createdAt: {\n        gte: startOfDay,\n        lte: endOfDay,\n      },\n    },\n    orderBy: {\n      createdAt: \"desc\",\n    },\n  });\n\n  let locations = markers.map((marker) => ({\n    uid: userId,\n    ts: marker.createdAt,\n    coords: {\n      lat: marker.lat,\n      lng: marker.long,\n      accuracy: marker.accuracy,\n      speed: marker.speed,\n      heading: marker.heading,\n    },\n    device: {},\n  }));\n\n  // Add fake history for Emily Wilson (test-user-4)\n  if (userId === \"test-user-4\") {\n    const baseTime = new Date();\n    const fakeHistory = [\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 3600000), // 1 hour ago\n        coords: {\n          lat: 42.5395,\n          lng: -113.782,\n          accuracy: 5,\n          speed: 0,\n          heading: 0,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 3300000), // 55 min ago\n        coords: {\n          lat: 42.5397,\n          lng: -113.7825,\n          accuracy: 6,\n          speed: 1.2,\n          heading: 45,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 3000000), // 50 min ago\n        coords: {\n          lat: 42.54,\n          lng: -113.783,\n          accuracy: 5,\n          speed: 1.5,\n          heading: 90,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 2700000), // 45 min ago\n        coords: {\n          lat: 42.5402,\n          lng: -113.7835,\n          accuracy: 7,\n          speed: 2.0,\n          heading: 45,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 2400000), // 40 min ago\n        coords: {\n          lat: 42.5405,\n          lng: -113.784,\n          accuracy: 6,\n          speed: 1.8,\n          heading: 0,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 2100000), // 35 min ago\n        coords: {\n          lat: 42.5408,\n          lng: -113.7838,\n          accuracy: 5,\n          speed: 1.2,\n          heading: 315,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 1800000), // 30 min ago\n        coords: {\n          lat: 42.541,\n          lng: -113.7833,\n          accuracy: 8,\n          speed: 0.5,\n          heading: 270,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 1500000), // 25 min ago\n        coords: {\n          lat: 42.5408,\n          lng: -113.7828,\n          accuracy: 6,\n          speed: 1.0,\n          heading: 180,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 1200000), // 20 min ago\n        coords: {\n          lat: 42.5405,\n          lng: -113.7822,\n          accuracy: 5,\n          speed: 1.5,\n          heading: 225,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 900000), // 15 min ago\n        coords: {\n          lat: 42.54,\n          lng: -113.7815,\n          accuracy: 7,\n          speed: 2.0,\n          heading: 270,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 600000), // 10 min ago\n        coords: {\n          lat: 42.5397,\n          lng: -113.781,\n          accuracy: 6,\n          speed: 1.8,\n          heading: 225,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: new Date(baseTime.getTime() - 300000), // 5 min ago\n        coords: {\n          lat: 42.5393,\n          lng: -113.7818,\n          accuracy: 5,\n          speed: 1.2,\n          heading: 90,\n        },\n        device: {},\n      },\n      {\n        uid: userId,\n        ts: baseTime, // now\n        coords: {\n          lat: 42.5393,\n          lng: -113.7823,\n          accuracy: 5,\n          speed: 0,\n          heading: 0,\n        },\n        device: {},\n      },\n    ];\n    locations = [...fakeHistory, ...locations];\n  }\n\n  return locations;\n}\n\nexport async function fetchAllUsersLatestLocations(\n  date: Date = new Date()\n): Promise<\n  Array<{\n    userId: string;\n    location: Location;\n    userName?: string;\n    profilePicture?: string | undefined;\n    phoneNumber?: string | undefined;\n    startTime?: string;\n    endTime?: string;\n  }>\n> {\n  try {\n    const { startOfDay, endOfDay } = getDayRange(date);\n\n    // Get all unique users who have location markers on the specified day\n    const sessions = await prisma.session.findMany({\n      distinct: [\"userId\"],\n      orderBy: {\n        startTime: \"desc\",\n      },\n\n      include: {\n        User: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n            image: true,\n            Contact: {\n              select: { phoneNumber: true },\n            },\n          },\n        },\n        locationMarkers: {\n          where: {\n            createdAt: {\n              gte: startOfDay,\n              lte: endOfDay,\n            },\n          },\n          orderBy: {\n            createdAt: \"desc\",\n          },\n          take: 1,\n        },\n      },\n    });\n\n    const allLocations: Array<{\n      userId: string;\n      location: Location;\n      userName?: string;\n      profilePicture?: string | undefined;\n      phoneNumber?: string | undefined;\n      startTime?: string;\n      endTime?: string;\n    }> = [];\n\n    for (const session of sessions) {\n      if (session.locationMarkers.length > 0) {\n        const marker = session.locationMarkers[0]!;\n        const userName = session.User\n          ? `${session.User.firstName} ${session.User.lastName || \"\"}`.trim()\n          : session.userId;\n\n        allLocations.push({\n          userId: session.userId,\n          location: {\n            uid: session.userId,\n            ts: marker.createdAt,\n            coords: {\n              lat: marker.lat,\n              lng: marker.long,\n              accuracy: marker.accuracy,\n              speed: marker.speed,\n              heading: marker.heading,\n            },\n            device: {},\n          },\n          userName,\n          profilePicture: session.User?.image || undefined,\n          phoneNumber: session.User?.Contact?.phoneNumber || undefined,\n          ...(session.startTime && {\n            startTime: session.startTime.toISOString(),\n          }),\n          ...(session.endTime && { endTime: session.endTime.toISOString() }),\n        });\n      }\n    }\n\n    // Append fake test users for development\n    const fakeUsers = [\n      {\n        userId: \"test-user-1\",\n        location: {\n          uid: \"test-user-1\",\n          ts: new Date(),\n          coords: {\n            lat: 42.5392,\n            lng: -113.7822,\n            accuracy: 5,\n            speed: 0,\n            heading: 0,\n          },\n          device: {},\n        },\n        userName: \"John Smith\",\n        profilePicture: \"https://api.dicebear.com/7.x/avataaars/svg?seed=John\",\n        phoneNumber: \"(208) 555-0101\",\n        startTime: new Date(Date.now() - 8 * 60 * 60 * 1000).toISOString(), // 8 hours ago\n        endTime: new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString(), // 1 hour from now\n      },\n      {\n        userId: \"test-user-2\",\n        location: {\n          uid: \"test-user-2\",\n          ts: new Date(),\n          coords: {\n            lat: 42.53925,\n            lng: -113.78225,\n            accuracy: 8,\n            speed: 2,\n            heading: 90,\n          },\n          device: {},\n        },\n        userName: \"Sarah Johnson\",\n        profilePicture: \"https://api.dicebear.com/7.x/avataaars/svg?seed=Sarah\",\n        phoneNumber: \"(208) 555-0102\",\n        startTime: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString(), // 6 hours ago\n        endTime: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(), // 2 hours from now\n      },\n      {\n        userId: \"test-user-3\",\n        location: {\n          uid: \"test-user-3\",\n          ts: new Date(),\n          coords: {\n            lat: 42.53915,\n            lng: -113.78215,\n            accuracy: 6,\n            speed: 1.5,\n            heading: 180,\n          },\n          device: {},\n        },\n        userName: \"Mike Davis\",\n        profilePicture: \"https://api.dicebear.com/7.x/avataaars/svg?seed=Mike\",\n        phoneNumber: \"(208) 555-0103\",\n        startTime: new Date(Date.now() - 4 * 60 * 60 * 1000).toISOString(), // 4 hours ago\n        endTime: new Date(Date.now() + 4 * 60 * 60 * 1000).toISOString(), // 4 hours from now\n      },\n      {\n        userId: \"test-user-4\",\n        location: {\n          uid: \"test-user-4\",\n          ts: new Date(),\n          coords: {\n            lat: 42.53935,\n            lng: -113.78235,\n            accuracy: 7,\n            speed: 3,\n            heading: 45,\n          },\n          device: {},\n        },\n        userName: \"Emily Wilson\",\n        profilePicture: \"https://api.dicebear.com/7.x/avataaars/svg?seed=Emily\",\n        phoneNumber: \"(208) 555-0104\",\n        startTime: new Date(Date.now() - 5 * 60 * 60 * 1000).toISOString(), // 5 hours ago\n        endTime: new Date(Date.now() + 3 * 60 * 60 * 1000).toISOString(), // 3 hours from now\n      },\n      {\n        userId: \"test-user-5\",\n        location: {\n          uid: \"test-user-5\",\n          ts: new Date(),\n          coords: {\n            lat: 42.539,\n            lng: -113.782,\n            accuracy: 9,\n            speed: 0.5,\n            heading: 270,\n          },\n          device: {},\n        },\n        userName: \"Robert Brown\",\n        profilePicture:\n          \"https://api.dicebear.com/7.x/avataaars/svg?seed=Robert\",\n        phoneNumber: \"(208) 555-0105\",\n        startTime: new Date(Date.now() - 7 * 60 * 60 * 1000).toISOString(), // 7 hours ago\n        endTime: new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString(), // 1 hour from now\n      },\n    ];\n\n    allLocations.push(...fakeUsers);\n\n    return allLocations;\n  } catch (err) {\n    console.error(\"Error fetching all users locations:\", err);\n    return [];\n  }\n}\n\nexport function validateLocationPayload(\n  payload: Partial<Location>\n): string | null {\n  if (\n    !payload.coords ||\n    typeof payload.coords.lat !== \"number\" ||\n    typeof payload.coords.lng !== \"number\"\n  ) {\n    return \"Missing or invalid coordinates\";\n  }\n  return null;\n}\n\nexport async function saveUserClockInLocation(\n  userId: string,\n  sessionId: number,\n  coords: Location[\"coords\"],\n  device?: Location[\"device\"]\n): Promise<boolean> {\n  try {\n    await prisma.locationMarker.create({\n      data: {\n        sessionId,\n        lat: coords.lat,\n        long: coords.lng,\n        accuracy: coords.accuracy ?? null,\n        speed: coords.speed ?? null,\n        heading: coords.heading ?? null,\n      },\n    });\n    return true;\n  } catch (err) {\n    console.error(\"Error saving location marker:\", err);\n    throw err;\n  }\n}\nexport async function saveUserClockOutLocation(\n  userId: string,\n  sessionId: number,\n  coords?: Location[\"coords\"],\n  device?: Location[\"device\"]\n): Promise<boolean> {\n  try {\n    await prisma.$transaction(async (tx) => {\n      await tx.session.update({\n        where: {\n          id: sessionId,\n        },\n        data: {\n          endTime: new Date(),\n        },\n      });\n    });\n    return true;\n  } catch (err) {\n    console.error(\"Error saving location marker:\", err);\n    throw err;\n  }\n}\n"],"names":[],"mappings":"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","debug_id":"f926564a-156c-5598-ba6a-afae281d20b4"}