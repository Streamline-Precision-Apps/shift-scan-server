{"version":3,"file":"tascoLogService.js","sources":["src/services/tascoLogService.ts"],"sourceRoot":"/","sourcesContent":["import prisma from \"../lib/prisma.js\";\n\n/**\n * TascoLog Service Layer\n * Handles all Prisma database operations for Tasco-related entities\n */\n\n// ============================================================================\n// TASCO LOG CRUD OPERATIONS\n// ============================================================================\n\n/**\n * Get a single Tasco Log by ID with all relations\n */\nexport async function getTascoLogById(tascoLogId: string) {\n  return await prisma.tascoLog.findUnique({\n    where: { id: tascoLogId },\n    include: {\n      Equipment: true,\n      TascoMaterialTypes: true,\n      TimeSheet: true,\n      RefuelLogs: true,\n      TascoFLoads: true,\n    },\n  });\n}\n\n/**\n * Get all Tasco Logs for a timesheet\n */\nexport async function getTascoLogsByTimesheet(timeSheetId: number) {\n  return await prisma.tascoLog.findMany({\n    where: { timeSheetId },\n    include: {\n      Equipment: true,\n      TascoMaterialTypes: true,\n      RefuelLogs: true,\n      TascoFLoads: true,\n    },\n  });\n}\n\n/**\n * Update Tasco Log (load quantity)\n */\nexport async function updateTascoLogLoadQuantity(\n  tascoLogId: string,\n  loadCount: number\n) {\n  return await prisma.tascoLog.update({\n    where: { id: tascoLogId },\n    data: {\n      LoadQuantity: loadCount,\n    },\n    include: {\n      Equipment: true,\n      TascoMaterialTypes: true,\n      RefuelLogs: true,\n      TascoFLoads: true,\n    },\n  });\n}\n\n/**\n * Update Tasco Log comment (through TimeSheet relation)\n */\nexport async function updateTascoLogComment(\n  tascoLogId: string,\n  comment: string\n) {\n  return await prisma.tascoLog.update({\n    where: { id: tascoLogId },\n    data: {\n      TimeSheet: {\n        update: {\n          comment,\n        },\n      },\n    },\n    include: {\n      TimeSheet: true,\n      Equipment: true,\n      TascoMaterialTypes: true,\n      RefuelLogs: true,\n      TascoFLoads: true,\n    },\n  });\n}\n\n// ============================================================================\n// REFUEL LOG CRUD OPERATIONS\n// ============================================================================\n\n/**\n * Create a new Refuel Log for Tasco\n */\nexport async function createTascoRefuelLog(tascoLogId: string) {\n  return await prisma.refuelLog.create({\n    data: {\n      tascoLogId,\n      gallonsRefueled: 0,\n    },\n  });\n}\n\n/**\n * Get all Refuel Logs for a Tasco Log\n */\nexport async function getTascoRefuelLogs(tascoLogId: string) {\n  return await prisma.refuelLog.findMany({\n    where: { tascoLogId },\n  });\n}\n\n/**\n * Update Refuel Log\n */\nexport async function updateTascoRefuelLog(\n  refuelLogId: string,\n  gallonsRefueled?: number,\n  milesAtFueling?: number\n) {\n  const updateData: Record<string, number> = {};\n\n  if (gallonsRefueled !== undefined) {\n    updateData.gallonsRefueled = gallonsRefueled;\n  }\n  if (milesAtFueling !== undefined) {\n    updateData.milesAtFueling = milesAtFueling;\n  }\n\n  return await prisma.refuelLog.update({\n    where: { id: refuelLogId },\n    data: updateData,\n  });\n}\n\n/**\n * Delete Refuel Log\n */\nexport async function deleteTascoRefuelLog(refuelLogId: string) {\n  return await prisma.refuelLog.delete({\n    where: { id: refuelLogId },\n  });\n}\n\n// ============================================================================\n// TASCO F-LOADS CRUD OPERATIONS\n// ============================================================================\n\n/**\n * Create a new TascoFLoad\n */\nexport async function createTascoFLoad(tascoLogId: string) {\n  return await prisma.tascoFLoads.create({\n    data: {\n      tascoLogId,\n      weight: null,\n      screenType: null,\n    },\n  });\n}\n\n/**\n * Get all TascoFLoads for a Tasco Log\n */\nexport async function getTascoFLoads(tascoLogId: string) {\n  return await prisma.tascoFLoads.findMany({\n    where: { tascoLogId },\n  });\n}\n\n/**\n * Update TascoFLoad\n */\nexport async function updateTascoFLoad(\n  fLoadId: number,\n  weight?: number | null,\n  screenType?: string | null\n) {\n  const updateData: Record<string, any> = {};\n\n  if (weight !== undefined) {\n    updateData.weight = weight;\n  }\n  if (screenType !== undefined) {\n    updateData.screenType = screenType;\n  }\n\n  return await prisma.tascoFLoads.update({\n    where: { id: fLoadId },\n    data: updateData,\n  });\n}\n\n/**\n * Delete TascoFLoad\n */\nexport async function deleteTascoFLoad(fLoadId: number) {\n  return await prisma.tascoFLoads.delete({\n    where: { id: fLoadId },\n  });\n}\n\n// ============================================================================\n// BULK/TRANSACTION OPERATIONS\n// ============================================================================\n\n/**\n * Get complete Tasco Log data including all nested relations\n */\nexport async function getCompleteTascoLogData(tascoLogId: string) {\n  return await prisma.tascoLog.findUnique({\n    where: { id: tascoLogId },\n    include: {\n      TimeSheet: true,\n      Equipment: true,\n      TascoMaterialTypes: true,\n      RefuelLogs: true,\n      TascoFLoads: true,\n    },\n  });\n}\n\n/**\n * Delete entire Tasco Log with all relations (cascades handled by Prisma)\n */\nexport async function deleteTascoLog(tascoLogId: string) {\n  return await prisma.tascoLog.delete({\n    where: { id: tascoLogId },\n  });\n}\n\nexport async function getTascoLogId(userId: string) {\n  return await prisma.timeSheet.findFirst({\n    where: {\n      userId,\n      endTime: null,\n    },\n    select: {\n      TascoLogs: {\n        select: {\n          id: true,\n        },\n      },\n    },\n  });\n}\n\nexport async function getTascoLogComment(tascoLogId: string) {\n  return await prisma.tascoLog.findFirst({\n    where: {\n      id: tascoLogId,\n    },\n    select: {\n      TimeSheet: {\n        select: {\n          comment: true,\n        },\n      },\n    },\n  });\n}\n\nexport async function getTascoLogFLoad(tascoLogId: string) {\n  return await prisma.tascoFLoads.findMany({\n    where: {\n      tascoLogId: tascoLogId,\n    },\n  });\n}\nexport async function getTascoLogLoadCount(tascoLogId: string) {\n  return await prisma.tascoLog.findFirst({\n    where: {\n      id: tascoLogId,\n    },\n    select: {\n      LoadQuantity: true,\n    },\n  });\n}\n\nexport async function getTascoLogRefuelLogs(tascoLogId: string) {\n  return await prisma.refuelLog.findMany({\n    where: {\n      tascoLogId,\n    },\n  });\n}\n\n/**\n * Get the active Tasco Log for a user (from their active timesheet)\n */\nexport async function getActiveTascoLogForUser(userId: string) {\n  const activeTimesheet = await prisma.timeSheet.findFirst({\n    where: {\n      userId,\n      endTime: null, // Active timesheet has no end time\n    },\n    select: {\n      TascoLogs: {\n        take: 1, // Get the first (or most recent) Tasco Log\n      },\n    },\n  });\n\n  if (!activeTimesheet || activeTimesheet.TascoLogs.length === 0) {\n    return null;\n  }\n\n  return activeTimesheet.TascoLogs[0];\n}\n"],"names":[],"mappings":"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","debug_id":"0d384df8-d225-51d5-a8e6-d6bbc4e0caa7"}