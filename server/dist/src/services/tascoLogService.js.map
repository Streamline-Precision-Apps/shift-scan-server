{"version":3,"file":"tascoLogService.js","sources":["src/services/tascoLogService.ts"],"sourceRoot":"/","sourcesContent":["import prisma from \"../lib/prisma.js\";\r\n\r\n/**\r\n * TascoLog Service Layer\r\n * Handles all Prisma database operations for Tasco-related entities\r\n */\r\n\r\n// ============================================================================\r\n// TASCO LOG CRUD OPERATIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Get a single Tasco Log by ID with all relations\r\n */\r\nexport async function getTascoLogById(tascoLogId: string) {\r\n  return await prisma.tascoLog.findUnique({\r\n    where: { id: tascoLogId },\r\n    include: {\r\n      Equipment: true,\r\n      TascoMaterialTypes: true,\r\n      TimeSheet: true,\r\n      RefuelLogs: true,\r\n      TascoFLoads: true,\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Get all Tasco Logs for a timesheet\r\n */\r\nexport async function getTascoLogsByTimesheet(timeSheetId: number) {\r\n  return await prisma.tascoLog.findMany({\r\n    where: { timeSheetId },\r\n    include: {\r\n      Equipment: true,\r\n      TascoMaterialTypes: true,\r\n      RefuelLogs: true,\r\n      TascoFLoads: true,\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Update Tasco Log (load quantity)\r\n */\r\nexport async function updateTascoLogLoadQuantity(\r\n  tascoLogId: string,\r\n  loadCount: number\r\n) {\r\n  return await prisma.tascoLog.update({\r\n    where: { id: tascoLogId },\r\n    data: {\r\n      LoadQuantity: loadCount,\r\n    },\r\n    include: {\r\n      Equipment: true,\r\n      TascoMaterialTypes: true,\r\n      RefuelLogs: true,\r\n      TascoFLoads: true,\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Update Tasco Log comment (through TimeSheet relation)\r\n */\r\nexport async function updateTascoLogComment(\r\n  tascoLogId: string,\r\n  comment: string\r\n) {\r\n  return await prisma.tascoLog.update({\r\n    where: { id: tascoLogId },\r\n    data: {\r\n      TimeSheet: {\r\n        update: {\r\n          comment,\r\n        },\r\n      },\r\n    },\r\n    include: {\r\n      TimeSheet: true,\r\n      Equipment: true,\r\n      TascoMaterialTypes: true,\r\n      RefuelLogs: true,\r\n      TascoFLoads: true,\r\n    },\r\n  });\r\n}\r\n\r\n// ============================================================================\r\n// REFUEL LOG CRUD OPERATIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Create a new Refuel Log for Tasco\r\n */\r\nexport async function createTascoRefuelLog(tascoLogId: string) {\r\n  return await prisma.refuelLog.create({\r\n    data: {\r\n      tascoLogId,\r\n      gallonsRefueled: 0,\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Get all Refuel Logs for a Tasco Log\r\n */\r\nexport async function getTascoRefuelLogs(tascoLogId: string) {\r\n  return await prisma.refuelLog.findMany({\r\n    where: { tascoLogId },\r\n  });\r\n}\r\n\r\n/**\r\n * Update Refuel Log\r\n */\r\nexport async function updateTascoRefuelLog(\r\n  refuelLogId: string,\r\n  gallonsRefueled?: number,\r\n  milesAtFueling?: number\r\n) {\r\n  const updateData: Record<string, number> = {};\r\n\r\n  if (gallonsRefueled !== undefined) {\r\n    updateData.gallonsRefueled = gallonsRefueled;\r\n  }\r\n  if (milesAtFueling !== undefined) {\r\n    updateData.milesAtFueling = milesAtFueling;\r\n  }\r\n\r\n  return await prisma.refuelLog.update({\r\n    where: { id: refuelLogId },\r\n    data: updateData,\r\n  });\r\n}\r\n\r\n/**\r\n * Delete Refuel Log\r\n */\r\nexport async function deleteTascoRefuelLog(refuelLogId: string) {\r\n  return await prisma.refuelLog.delete({\r\n    where: { id: refuelLogId },\r\n  });\r\n}\r\n\r\n// ============================================================================\r\n// TASCO F-LOADS CRUD OPERATIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Create a new TascoFLoad\r\n */\r\nexport async function createTascoFLoad(tascoLogId: string) {\r\n  return await prisma.tascoFLoads.create({\r\n    data: {\r\n      tascoLogId,\r\n      weight: null,\r\n      screenType: null,\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Get all TascoFLoads for a Tasco Log\r\n */\r\nexport async function getTascoFLoads(tascoLogId: string) {\r\n  return await prisma.tascoFLoads.findMany({\r\n    where: { tascoLogId },\r\n  });\r\n}\r\n\r\n/**\r\n * Update TascoFLoad\r\n */\r\nexport async function updateTascoFLoad(\r\n  fLoadId: number,\r\n  weight?: number | null,\r\n  screenType?: string | null\r\n) {\r\n  const updateData: Record<string, any> = {};\r\n\r\n  if (weight !== undefined) {\r\n    updateData.weight = weight;\r\n  }\r\n  if (screenType !== undefined) {\r\n    updateData.screenType = screenType;\r\n  }\r\n\r\n  return await prisma.tascoFLoads.update({\r\n    where: { id: fLoadId },\r\n    data: updateData,\r\n  });\r\n}\r\n\r\n/**\r\n * Delete TascoFLoad\r\n */\r\nexport async function deleteTascoFLoad(fLoadId: number) {\r\n  return await prisma.tascoFLoads.delete({\r\n    where: { id: fLoadId },\r\n  });\r\n}\r\n\r\n// ============================================================================\r\n// BULK/TRANSACTION OPERATIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Get complete Tasco Log data including all nested relations\r\n */\r\nexport async function getCompleteTascoLogData(tascoLogId: string) {\r\n  return await prisma.tascoLog.findUnique({\r\n    where: { id: tascoLogId },\r\n    include: {\r\n      TimeSheet: true,\r\n      Equipment: true,\r\n      TascoMaterialTypes: true,\r\n      RefuelLogs: true,\r\n      TascoFLoads: true,\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Delete entire Tasco Log with all relations (cascades handled by Prisma)\r\n */\r\nexport async function deleteTascoLog(tascoLogId: string) {\r\n  return await prisma.tascoLog.delete({\r\n    where: { id: tascoLogId },\r\n  });\r\n}\r\n\r\nexport async function getTascoLogId(userId: string) {\r\n  return await prisma.timeSheet.findFirst({\r\n    where: {\r\n      userId,\r\n      endTime: null,\r\n    },\r\n    select: {\r\n      TascoLogs: {\r\n        select: {\r\n          id: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n}\r\n\r\nexport async function getTascoLogComment(tascoLogId: string) {\r\n  return await prisma.tascoLog.findFirst({\r\n    where: {\r\n      id: tascoLogId,\r\n    },\r\n    select: {\r\n      TimeSheet: {\r\n        select: {\r\n          comment: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n}\r\n\r\nexport async function getTascoLogFLoad(tascoLogId: string) {\r\n  return await prisma.tascoFLoads.findMany({\r\n    where: {\r\n      tascoLogId: tascoLogId,\r\n    },\r\n  });\r\n}\r\nexport async function getTascoLogLoadCount(tascoLogId: string) {\r\n  return await prisma.tascoLog.findFirst({\r\n    where: {\r\n      id: tascoLogId,\r\n    },\r\n    select: {\r\n      LoadQuantity: true,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function getTascoLogRefuelLogs(tascoLogId: string) {\r\n  return await prisma.refuelLog.findMany({\r\n    where: {\r\n      tascoLogId,\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Get the active Tasco Log for a user (from their active timesheet)\r\n */\r\nexport async function getActiveTascoLogForUser(userId: string) {\r\n  const activeTimesheet = await prisma.timeSheet.findFirst({\r\n    where: {\r\n      userId,\r\n      endTime: null, // Active timesheet has no end time\r\n    },\r\n    select: {\r\n      TascoLogs: {\r\n        take: 1, // Get the first (or most recent) Tasco Log\r\n      },\r\n    },\r\n  });\r\n\r\n  if (!activeTimesheet || activeTimesheet.TascoLogs.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return activeTimesheet.TascoLogs[0];\r\n}\r\n"],"names":[],"mappings":"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","debug_id":"25b82cba-f5b9-59ae-bcff-0d71ed473703"}