{"version":3,"file":"timesheetService.js","sources":["src/services/timesheetService.ts"],"sourceRoot":"/","sourcesContent":["import { formatISO } from \"date-fns\";\r\nimport type { EquipmentState, Prisma } from \"../../generated/prisma/index.js\";\r\nimport type {\r\n  GeneralTimesheetInput,\r\n  MechanicTimesheetInput,\r\n  TascoTimesheetInput,\r\n  TruckTimesheetInput,\r\n} from \"../controllers/timesheetController.js\";\r\nimport prisma from \"../lib/prisma.js\";\r\n\r\nexport async function updateTimesheetService({\r\n  id,\r\n  editorId,\r\n  changes,\r\n  changeReason,\r\n  numberOfChanges,\r\n  startTime,\r\n  endTime,\r\n  Jobsite,\r\n  CostCode,\r\n  comment,\r\n}: {\r\n  id: number;\r\n  editorId: string;\r\n  changes: string;\r\n  changeReason?: string;\r\n  numberOfChanges?: number;\r\n  startTime: string;\r\n  endTime?: string;\r\n  Jobsite?: string;\r\n  CostCode?: string;\r\n  comment?: string;\r\n}) {\r\n  try {\r\n    const parsedChanges =\r\n      changes && typeof changes === \"string\"\r\n        ? JSON.parse(changes)\r\n        : changes || {};\r\n    const transactionResult = await prisma.$transaction(async (tx) => {\r\n      let editorLog = null;\r\n      let userFullname = null;\r\n      let editorFullName = null;\r\n\r\n      if (parsedChanges && Object.keys(parsedChanges).length > 0) {\r\n        editorLog = await tx.timeSheetChangeLog.create({\r\n          data: {\r\n            timeSheetId: id,\r\n            changedBy: editorId,\r\n            changes: parsedChanges,\r\n            changeReason: changeReason || \"No reason provided\",\r\n            numberOfChanges: numberOfChanges || 0,\r\n          },\r\n          include: {\r\n            User: {\r\n              select: {\r\n                firstName: true,\r\n                lastName: true,\r\n              },\r\n            },\r\n          },\r\n        });\r\n      }\r\n      editorFullName = editorLog\r\n        ? `${editorLog.User.firstName} ${editorLog.User.lastName}`\r\n        : \"Unknown Editor\";\r\n\r\n      // Build update data object dynamically to only update provided fields\r\n      const updateData: Prisma.TimeSheetUpdateInput = {};\r\n      if (typeof startTime !== \"undefined\") {\r\n        updateData.startTime = startTime;\r\n      }\r\n      if (typeof endTime !== \"undefined\") {\r\n        updateData.endTime = endTime ? new Date(endTime) : null;\r\n      }\r\n      if (typeof Jobsite !== \"undefined\" && Jobsite) {\r\n        updateData.Jobsite = { connect: { id: Jobsite } }; // or { id: Jobsite } if you use IDs\r\n      }\r\n      if (typeof CostCode !== \"undefined\" && CostCode) {\r\n        updateData.CostCode = { connect: { name: CostCode } }; // or { id: CostCode } if you use IDs\r\n      }\r\n      if (typeof comment !== \"undefined\") {\r\n        updateData.comment = comment;\r\n      }\r\n      const updated = await tx.timeSheet.update({\r\n        where: { id },\r\n        data: updateData,\r\n        include: {\r\n          Jobsite: true,\r\n          CostCode: true,\r\n          ChangeLogs: true,\r\n          User: {\r\n            select: {\r\n              firstName: true,\r\n              lastName: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n      userFullname = updated\r\n        ? `${updated.User.firstName} ${updated.User.lastName}`\r\n        : \"Unknown User\";\r\n\r\n      return { updated, editorLog, userFullname, editorFullName };\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      timesheet: transactionResult.updated,\r\n      editorLog: transactionResult.editorLog,\r\n      userFullname: transactionResult.userFullname,\r\n      editorFullName: transactionResult.editorFullName,\r\n    };\r\n  } catch (error) {\r\n    let message = \"Failed to update timesheet.\";\r\n    if (error instanceof Error) {\r\n      message = error.message;\r\n    }\r\n    return { error: message };\r\n  }\r\n}\r\n\r\n/**\r\n * Helper function to get start and end of day in local timezone\r\n * Converts a date string (YYYY-MM-DD) to the start and end times of that day\r\n * @param dateString - Date string in format YYYY-MM-DD\r\n * @returns Object with startOfDay and endOfDay as Date objects\r\n */\r\nfunction getDayRangeFromString(dateString: string): {\r\n  startOfDay: Date;\r\n  endOfDay: Date;\r\n} {\r\n  // Parse the date string in local timezone\r\n  const parts = dateString.split(\"-\");\r\n  const year = parseInt(parts[0]!, 10);\r\n  const month = parseInt(parts[1]!, 10) - 1; // JavaScript months are 0-indexed\r\n  const day = parseInt(parts[2]!, 10);\r\n\r\n  const startOfDay = new Date(year, month, day, 0, 0, 0, 0);\r\n  const endOfDay = new Date(year, month, day, 23, 59, 59, 999);\r\n\r\n  return { startOfDay, endOfDay };\r\n}\r\n\r\nexport async function getUserTimesheetsByDate({\r\n  employeeId,\r\n  dateParam,\r\n}: {\r\n  employeeId: string;\r\n  dateParam?: string | undefined;\r\n}) {\r\n  let start: Date | undefined = undefined;\r\n  let end: Date | undefined = undefined;\r\n  if (dateParam) {\r\n    const { startOfDay, endOfDay } = getDayRangeFromString(dateParam);\r\n    start = startOfDay;\r\n    end = endOfDay;\r\n  }\r\n\r\n  // Only include date filter if both start and end are defined\r\n  const where: Prisma.TimeSheetWhereInput = {\r\n    userId: employeeId,\r\n    status: {\r\n      not: \"DRAFT\",\r\n    },\r\n    ...(start && end ? { date: { gte: start, lte: end } } : {}),\r\n  };\r\n\r\n  const timesheetData = await prisma.timeSheet.findMany({\r\n    where,\r\n    select: {\r\n      id: true,\r\n      startTime: true,\r\n      endTime: true,\r\n      status: true,\r\n      workType: true,\r\n      Jobsite: {\r\n        select: {\r\n          name: true,\r\n        },\r\n      },\r\n      CostCode: {\r\n        select: {\r\n          name: true,\r\n        },\r\n      },\r\n    },\r\n    orderBy: { date: \"desc\" },\r\n  });\r\n  return timesheetData;\r\n}\r\n\r\nexport async function getTimesheetDetailsManager({\r\n  timesheetId,\r\n}: {\r\n  timesheetId: number;\r\n}) {\r\n  const timesheet = await prisma.timeSheet.findUnique({\r\n    where: { id: timesheetId },\r\n    select: {\r\n      id: true,\r\n      comment: true,\r\n      startTime: true,\r\n      endTime: true,\r\n      Jobsite: {\r\n        select: {\r\n          id: true,\r\n          name: true,\r\n        },\r\n      },\r\n      CostCode: {\r\n        select: {\r\n          id: true,\r\n          name: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n  return timesheet;\r\n}\r\n\r\n// Get all timesheets for all users in a manager's crew\r\nexport async function getManagerCrewTimesheets({\r\n  managerId,\r\n}: {\r\n  managerId: string;\r\n}) {\r\n  // Find all users in crews led by this manager\r\n  const crew = await prisma.user.findMany({\r\n    where: {\r\n      Crews: {\r\n        some: {\r\n          leadId: managerId,\r\n        },\r\n      },\r\n    },\r\n    select: {\r\n      id: true,\r\n      firstName: true,\r\n      lastName: true,\r\n      clockedIn: true,\r\n      Crews: {\r\n        select: {\r\n          id: true,\r\n          leadId: true,\r\n        },\r\n      },\r\n\r\n      TimeSheets: {\r\n        where: {\r\n          status: \"PENDING\",\r\n          endTime: { not: null },\r\n        },\r\n        select: {\r\n          id: true,\r\n          date: true,\r\n          startTime: true,\r\n          endTime: true,\r\n          jobsiteId: true,\r\n          workType: true,\r\n          Jobsite: {\r\n            select: {\r\n              name: true,\r\n            },\r\n          },\r\n          CostCode: {\r\n            select: {\r\n              name: true,\r\n            },\r\n          },\r\n          TascoLogs: {\r\n            select: {\r\n              id: true,\r\n              shiftType: true,\r\n              laborType: true,\r\n              materialType: true,\r\n              LoadQuantity: true,\r\n              Equipment: {\r\n                select: {\r\n                  id: true,\r\n                  name: true,\r\n                },\r\n              },\r\n              RefuelLogs: {\r\n                select: {\r\n                  id: true,\r\n                  gallonsRefueled: true,\r\n                  TascoLog: {\r\n                    select: {\r\n                      Equipment: {\r\n                        select: {\r\n                          name: true,\r\n                        },\r\n                      },\r\n                    },\r\n                  },\r\n                },\r\n              },\r\n            },\r\n          },\r\n          TruckingLogs: {\r\n            select: {\r\n              id: true,\r\n              laborType: true,\r\n              Truck: {\r\n                select: { id: true, name: true },\r\n              },\r\n              Trailer: {\r\n                select: { id: true, name: true },\r\n              },\r\n              Equipment: {\r\n                select: {\r\n                  id: true,\r\n                  name: true,\r\n                },\r\n              },\r\n              startingMileage: true,\r\n              endingMileage: true,\r\n              Materials: {\r\n                select: {\r\n                  id: true,\r\n                  name: true,\r\n                  quantity: true,\r\n                  loadType: true,\r\n                  unit: true,\r\n                  LocationOfMaterial: true,\r\n                  materialWeight: true,\r\n                },\r\n              },\r\n              EquipmentHauled: {\r\n                select: {\r\n                  id: true,\r\n                  source: true,\r\n                  destination: true,\r\n                  Equipment: {\r\n                    select: {\r\n                      name: true,\r\n                    },\r\n                  },\r\n                },\r\n              },\r\n              RefuelLogs: {\r\n                select: {\r\n                  id: true,\r\n                  gallonsRefueled: true,\r\n                  milesAtFueling: true,\r\n                  TruckingLog: {\r\n                    select: {\r\n                      Equipment: {\r\n                        select: {\r\n                          name: true,\r\n                        },\r\n                      },\r\n                    },\r\n                  },\r\n                },\r\n              },\r\n              StateMileages: {\r\n                select: {\r\n                  id: true,\r\n                  state: true,\r\n                  stateLineMileage: true,\r\n                  TruckingLog: {\r\n                    select: {\r\n                      Equipment: {\r\n                        select: {\r\n                          name: true,\r\n                        },\r\n                      },\r\n                    },\r\n                  },\r\n                },\r\n              },\r\n            },\r\n          },\r\n          EmployeeEquipmentLogs: {\r\n            select: {\r\n              id: true,\r\n              startTime: true,\r\n              endTime: true,\r\n              Equipment: {\r\n                select: {\r\n                  id: true,\r\n                  name: true,\r\n                },\r\n              },\r\n              RefuelLog: {\r\n                select: {\r\n                  id: true,\r\n                  gallonsRefueled: true,\r\n                },\r\n              },\r\n            },\r\n          },\r\n          status: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n  return crew;\r\n}\r\n// Batch approve timesheets and handle notifications\r\nexport async function approveTimesheetsBatchService({\r\n  userId,\r\n  timesheetIds,\r\n  statusComment,\r\n  editorId,\r\n}: {\r\n  userId: string;\r\n  timesheetIds: number[];\r\n  statusComment: string;\r\n  editorId: string;\r\n}) {\r\n  try {\r\n    // Update all matching timesheets with the same values\r\n    await prisma.timeSheet.updateMany({\r\n      where: {\r\n        id: { in: timesheetIds },\r\n        userId,\r\n      },\r\n      data: {\r\n        status: \"APPROVED\",\r\n        statusComment,\r\n      },\r\n    });\r\n\r\n    // check for notifications\r\n    const notifications = await prisma.notification.findMany({\r\n      where: {\r\n        topic: \"timecard-submission\",\r\n        referenceId: { in: timesheetIds.map(String) },\r\n        Response: { is: null },\r\n      },\r\n    });\r\n\r\n    if (notifications.length > 0) {\r\n      // Filter out notifications that already have a notificationRead for this user\r\n      const existingReads = await prisma.notificationRead.findMany({\r\n        where: {\r\n          notificationId: { in: notifications.map((n) => n.id) },\r\n          userId: editorId,\r\n        },\r\n        select: { notificationId: true },\r\n      });\r\n      const alreadyReadIds = new Set(\r\n        existingReads.map((r) => r.notificationId)\r\n      );\r\n      const unreadNotifications = notifications.filter(\r\n        (n) => !alreadyReadIds.has(n.id)\r\n      );\r\n      await prisma.$transaction(async (tx) => {\r\n        if (unreadNotifications.length > 0) {\r\n          await tx.notificationRead.createMany({\r\n            data: unreadNotifications.map((n) => ({\r\n              notificationId: n.id,\r\n              userId: editorId,\r\n              readAt: new Date(),\r\n            })),\r\n            skipDuplicates: true,\r\n          });\r\n        }\r\n        await tx.notificationResponse.createMany({\r\n          data: notifications.map((n) => ({\r\n            notificationId: n.id,\r\n            userId: editorId,\r\n            response: \"Approved\",\r\n            respondedAt: new Date(),\r\n          })),\r\n          skipDuplicates: true,\r\n        });\r\n      });\r\n    }\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Error updating timesheets:\", error);\r\n    return { success: false, error: \"Failed to update timesheets\" };\r\n  }\r\n}\r\n\r\nexport async function createGeneralTimesheetService({\r\n  data,\r\n  type,\r\n}: {\r\n  data: GeneralTimesheetInput;\r\n  type?: string;\r\n}) {\r\n  const createdTimeSheet = await prisma.$transaction(async (prisma) => {\r\n    // Build create data\r\n    const createData: any = {\r\n      date: data.date,\r\n      Jobsite: { connect: { id: data.jobsiteId } },\r\n      User: { connect: { id: data.userId } },\r\n      CostCode: { connect: { name: data.costCode } },\r\n      startTime: data.startTime,\r\n      workType: \"LABOR\",\r\n      status: \"DRAFT\",\r\n      clockInLat: data.clockInLat || null,\r\n      clockInLng: data.clockInLong || null,\r\n    };\r\n\r\n    if (data.sessionId !== null && data.sessionId !== undefined) {\r\n      createData.Session = {\r\n        connect: {\r\n          id: data.sessionId,\r\n        },\r\n      };\r\n    }\r\n\r\n    // Step 1: Create a new TimeSheet\r\n    const createdTimeSheet = await prisma.timeSheet.create({\r\n      data: createData,\r\n      include: {\r\n        User: {\r\n          select: {\r\n            firstName: true,\r\n            lastName: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    // Update user status if timesheet created successfully\r\n    if (createdTimeSheet) {\r\n      await prisma.user.update({\r\n        where: { id: data.userId },\r\n        data: {\r\n          clockedIn: true,\r\n        },\r\n      });\r\n    }\r\n    if (type === \"switchJobs\" && data.previousTimeSheetId && data.endTime) {\r\n      await prisma.timeSheet.update({\r\n        where: { id: data.previousTimeSheetId },\r\n        data: {\r\n          endTime: formatISO(data.endTime),\r\n          comment: data.previoustimeSheetComments || null,\r\n          status: \"PENDING\",\r\n          clockOutLat: data.clockOutLat || null,\r\n          clockOutLng: data.clockOutLong || null,\r\n        },\r\n      });\r\n    }\r\n    return createdTimeSheet;\r\n  });\r\n  return createdTimeSheet;\r\n}\r\n\r\nexport async function createMechanicTimesheetService({\r\n  data,\r\n  type,\r\n}: {\r\n  data: MechanicTimesheetInput;\r\n  type?: string;\r\n}) {\r\n  // Implementation for creating a mechanic timesheet\r\n  const createdTimeCard = await prisma.$transaction(async (prisma) => {\r\n    // Build create data\r\n    const createData: any = {\r\n      date: formatISO(data.date),\r\n      Jobsite: { connect: { id: data.jobsiteId } },\r\n      User: { connect: { id: data.userId } },\r\n      CostCode: { connect: { name: data.costCode } },\r\n      startTime: formatISO(data.startTime),\r\n      workType: \"MECHANIC\",\r\n      status: \"DRAFT\",\r\n      clockInLat: data.clockInLat || null,\r\n      clockInLng: data.clockInLong || null,\r\n    };\r\n\r\n    if (data.sessionId !== null && data.sessionId !== undefined) {\r\n      createData.Session = {\r\n        connect: {\r\n          id: data.sessionId,\r\n        },\r\n      };\r\n    }\r\n\r\n    // Step 1: Create a new TimeSheet\r\n    const createdTimeSheet = await prisma.timeSheet.create({\r\n      data: createData,\r\n      include: {\r\n        User: {\r\n          select: {\r\n            firstName: true,\r\n            lastName: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (createdTimeSheet) {\r\n      await prisma.user.update({\r\n        where: { id: data.userId },\r\n        data: {\r\n          clockedIn: true,\r\n        },\r\n      });\r\n    }\r\n    if (type === \"switchJobs\" && data.previousTimeSheetId && data.endTime) {\r\n      await prisma.timeSheet.update({\r\n        where: { id: data.previousTimeSheetId },\r\n        data: {\r\n          endTime: formatISO(data.endTime),\r\n          comment: data.previoustimeSheetComments || null,\r\n          status: \"PENDING\",\r\n          clockOutLat: data.clockOutLat || null,\r\n          clockOutLng: data.clockOutLong || null,\r\n        },\r\n      });\r\n    }\r\n    return createdTimeSheet;\r\n  });\r\n\r\n  return createdTimeCard;\r\n}\r\n\r\nexport async function createTruckDriverTimesheetService({\r\n  data,\r\n  type,\r\n}: {\r\n  data: TruckTimesheetInput;\r\n  type?: string;\r\n}) {\r\n  // Implementation for creating a truck driver timesheet\r\n  return await prisma.$transaction(async (prisma) => {\r\n    // Build create data\r\n    const createData: any = {\r\n      date: formatISO(data.date),\r\n      Jobsite: { connect: { id: data.jobsiteId } },\r\n      User: { connect: { id: data.userId } },\r\n      CostCode: { connect: { name: data.costCode } },\r\n      startTime: formatISO(data.startTime),\r\n      workType: \"TRUCK_DRIVER\",\r\n      status: \"DRAFT\",\r\n      clockInLat: data.clockInLat || null,\r\n      clockInLng: data.clockInLong || null,\r\n      TruckingLogs: {\r\n        create: {\r\n          laborType: data.laborType,\r\n          truckNumber: data.truck,\r\n          equipmentId: data.equipmentId || null,\r\n          startingMileage: data.startingMileage,\r\n          trailerNumber: null,\r\n        },\r\n      },\r\n    };\r\n\r\n    if (data.sessionId !== null && data.sessionId !== undefined) {\r\n      createData.Session = {\r\n        connect: {\r\n          id: data.sessionId,\r\n        },\r\n      };\r\n    }\r\n\r\n    // Step 1: Create a new TimeSheet\r\n    const createdTimeSheet = await prisma.timeSheet.create({\r\n      data: createData,\r\n      include: {\r\n        User: {\r\n          select: {\r\n            firstName: true,\r\n            lastName: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (createdTimeSheet) {\r\n      await prisma.user.update({\r\n        where: { id: data.userId },\r\n        data: {\r\n          clockedIn: true,\r\n        },\r\n      });\r\n    }\r\n    if (type === \"switchJobs\" && data.previousTimeSheetId && data.endTime) {\r\n      await prisma.timeSheet.update({\r\n        where: { id: data.previousTimeSheetId },\r\n        data: {\r\n          endTime: formatISO(data.endTime),\r\n          comment: data.previoustimeSheetComments || null,\r\n          status: \"PENDING\",\r\n          clockOutLat: data.clockOutLat || null,\r\n          clockOutLng: data.clockOutLong || null,\r\n        },\r\n      });\r\n    }\r\n    return createdTimeSheet;\r\n  });\r\n}\r\n\r\nexport async function createTascoTimesheetService({\r\n  data,\r\n  type,\r\n}: {\r\n  data: TascoTimesheetInput;\r\n  type?: string;\r\n}) {\r\n  // Implementation for creating a tasco timesheet\r\n  // Only DB operations in transaction\r\n  return await prisma.$transaction(async (prisma) => {\r\n    // Build create data\r\n    const createData: any = {\r\n      date: formatISO(data.date),\r\n      Jobsite: { connect: { id: data.jobsiteId } },\r\n      User: { connect: { id: data.userId } },\r\n      CostCode: { connect: { name: data.costCode } },\r\n      startTime: formatISO(data.startTime),\r\n      workType: \"TASCO\",\r\n      status: \"DRAFT\",\r\n      clockInLat: data.clockInLat || null,\r\n      clockInLng: data.clockInLong || null,\r\n      TascoLogs: {\r\n        create: {\r\n          shiftType: data.shiftType ?? \"\",\r\n          laborType: data.laborType ?? \"\",\r\n          ...(data.equipmentId && {\r\n            Equipment: { connect: { id: data.equipmentId } },\r\n          }),\r\n          ...(data.materialType && {\r\n            TascoMaterialTypes: { connect: { name: data.materialType } },\r\n          }),\r\n        },\r\n      },\r\n    };\r\n\r\n    if (data.sessionId !== null && data.sessionId !== undefined) {\r\n      createData.Session = {\r\n        connect: {\r\n          id: data.sessionId,\r\n        },\r\n      };\r\n    }\r\n\r\n    // Step 1: Create a new TimeSheet\r\n    const createdTimeSheet = await prisma.timeSheet.create({\r\n      data: createData,\r\n      include: {\r\n        User: {\r\n          select: {\r\n            firstName: true,\r\n            lastName: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (createdTimeSheet) {\r\n      await prisma.user.update({\r\n        where: { id: data.userId },\r\n        data: {\r\n          clockedIn: true,\r\n        },\r\n      });\r\n    }\r\n    if (type === \"switchJobs\" && data.previousTimeSheetId && data.endTime) {\r\n      await prisma.timeSheet.update({\r\n        where: { id: data.previousTimeSheetId },\r\n        data: {\r\n          endTime: formatISO(data.endTime),\r\n          comment: data.previoustimeSheetComments || null,\r\n          status: \"PENDING\",\r\n          clockOutLat: data.clockOutLat || null,\r\n          clockOutLng: data.clockOutLong || null,\r\n        },\r\n      });\r\n    }\r\n    return createdTimeSheet;\r\n  });\r\n}\r\n\r\nexport async function getRecentTimeSheetForUser(userId: string) {\r\n  // Implementation for fetching recent timesheet for a user\r\n  // Fetch the most recent active (unfinished) timesheet for the user\r\n  const timesheet = await prisma.timeSheet.findFirst({\r\n    where: {\r\n      userId,\r\n      endTime: null, // Ensure timesheet is still active\r\n    },\r\n    orderBy: {\r\n      createdAt: \"desc\", // Sort by most recent submission date\r\n    },\r\n    select: {\r\n      id: true,\r\n      endTime: true,\r\n    },\r\n  });\r\n\r\n  return timesheet;\r\n}\r\n\r\nexport async function getTimesheetActiveStatus({ userId }: { userId: string }) {\r\n  // Implementation for checking active timesheet status\r\n  const activeTimesheet = await prisma.timeSheet.findFirst({\r\n    where: {\r\n      userId: userId,\r\n      endTime: null, // No end time means still active\r\n    },\r\n    select: {\r\n      id: true,\r\n      startTime: true,\r\n    },\r\n  });\r\n\r\n  const hasActiveTimesheet = activeTimesheet ? true : false;\r\n  return {\r\n    hasActiveTimesheet: hasActiveTimesheet,\r\n    timesheetId: activeTimesheet?.id || null,\r\n  };\r\n}\r\n\r\nexport async function getBannerDataForTimesheet(\r\n  timesheetId: number,\r\n  userId: string\r\n) {\r\n  // Implementation for fetching banner data\r\n  const jobCode = await prisma.timeSheet.findFirst({\r\n    where: { userId, id: timesheetId },\r\n    select: {\r\n      id: true,\r\n      startTime: true,\r\n      Jobsite: {\r\n        select: { id: true, qrId: true, name: true },\r\n      },\r\n      CostCode: {\r\n        select: { id: true, name: true, code: true },\r\n      },\r\n    },\r\n  });\r\n  if (!jobCode) {\r\n    throw new Error(\"No active timesheet found.\");\r\n  }\r\n  // Parallelize queries for performance\r\n  const [tascoLogs, truckingLogs, eqLogs] = await Promise.all([\r\n    prisma.tascoLog.findMany({\r\n      where: { timeSheetId: timesheetId },\r\n      select: {\r\n        shiftType: true,\r\n        laborType: true,\r\n        Equipment: { select: { qrId: true, name: true } },\r\n      },\r\n    }),\r\n    prisma.truckingLog.findMany({\r\n      where: { timeSheetId: timesheetId },\r\n      select: {\r\n        laborType: true,\r\n        Truck: { select: { qrId: true, name: true } },\r\n        Equipment: { select: { qrId: true, name: true } },\r\n      },\r\n    }),\r\n    prisma.employeeEquipmentLog.findMany({\r\n      where: { timeSheetId: timesheetId, endTime: null },\r\n      select: {\r\n        id: true,\r\n        startTime: true,\r\n        endTime: true,\r\n        Equipment: { select: { id: true, name: true } },\r\n      },\r\n    }),\r\n  ]);\r\n\r\n  // Format Logs\r\n  const formattedTascoLogs = tascoLogs.map((log) => ({\r\n    laborType: log.laborType,\r\n    shiftType: log.shiftType,\r\n    equipment: log.Equipment || { qrId: null, name: \"Unknown\" },\r\n  }));\r\n\r\n  const formattedTruckingLogs = truckingLogs.map((log) => ({\r\n    laborType: log.laborType,\r\n    equipment: log.Truck || { qrId: null, name: \"Unknown\" },\r\n  }));\r\n\r\n  const formattedEmployeeEquipmentLogs = eqLogs.map((log) => ({\r\n    id: log.id,\r\n    startTime: log.startTime,\r\n    endTime: log.endTime,\r\n    equipment: log.Equipment || { id: null, name: \"Unknown\" },\r\n  }));\r\n\r\n  return {\r\n    id: jobCode.id,\r\n    startTime: jobCode.startTime,\r\n    jobsite: jobCode.Jobsite\r\n      ? {\r\n          id: jobCode.Jobsite.id,\r\n          qrId: jobCode.Jobsite.qrId,\r\n          name: jobCode.Jobsite.name,\r\n        }\r\n      : null,\r\n    costCode: jobCode.CostCode\r\n      ? {\r\n          id: jobCode.CostCode.id,\r\n          name: jobCode.CostCode.name,\r\n        }\r\n      : null,\r\n    tascoLogs: formattedTascoLogs,\r\n    truckingLogs: formattedTruckingLogs,\r\n    employeeEquipmentLogs: formattedEmployeeEquipmentLogs,\r\n  };\r\n}\r\n\r\n// TypeScript Types for Safety and Consistency\r\ntype EquipmentLog = {\r\n  id: string;\r\n  type: \"equipment\";\r\n  userId: string;\r\n  equipment: {\r\n    id: string;\r\n    qrId: string;\r\n    name: string;\r\n  } | null;\r\n};\r\n\r\ntype MaintenanceLog = {\r\n  id: string;\r\n  type: \"mechanic\";\r\n  maintenanceId: string;\r\n  userId: string;\r\n  submitted: boolean;\r\n};\r\n\r\ntype TruckingLog = {\r\n  id: string;\r\n  laborType: string;\r\n  endingMileage: number | null;\r\n  stateMileage: boolean;\r\n  refueled: boolean;\r\n  material: boolean;\r\n  equipmentHauled: boolean;\r\n};\r\n\r\ntype TascoLog = {\r\n  id: string;\r\n  shiftType: string | null;\r\n  laborType: string | null;\r\n  loadQuantity: number | null;\r\n  refueled: boolean;\r\n  fLoads: boolean;\r\n};\r\n\r\nexport async function getLogsForDashboard(userId: string) {\r\n  const [employeeLogs, maintenanceLogs, truckingLogs, tascoLogs] =\r\n    await Promise.all([\r\n      prisma.employeeEquipmentLog.findMany({\r\n        where: {\r\n          TimeSheet: {\r\n            userId: userId,\r\n          },\r\n          endTime: null,\r\n        },\r\n        include: {\r\n          Equipment: {\r\n            select: {\r\n              id: true,\r\n              qrId: true,\r\n              name: true,\r\n            },\r\n          },\r\n        },\r\n      }),\r\n\r\n      prisma.maintenanceLog.findMany({\r\n        where: {\r\n          userId: userId,\r\n          endTime: null,\r\n        },\r\n        select: {\r\n          id: true,\r\n          maintenanceId: true,\r\n        },\r\n      }),\r\n\r\n      prisma.truckingLog.findMany({\r\n        where: {\r\n          TimeSheet: {\r\n            userId: userId,\r\n            endTime: null,\r\n          },\r\n        },\r\n        select: {\r\n          id: true,\r\n          endingMileage: true,\r\n          laborType: true,\r\n          startingMileage: true,\r\n          StateMileages: {\r\n            select: {\r\n              id: true,\r\n              state: true,\r\n              stateLineMileage: true,\r\n            },\r\n          },\r\n          RefuelLogs: {\r\n            select: {\r\n              id: true,\r\n              gallonsRefueled: true,\r\n              milesAtFueling: true,\r\n            },\r\n          },\r\n          Materials: {\r\n            select: {\r\n              id: true,\r\n              LocationOfMaterial: true,\r\n              name: true,\r\n              quantity: true,\r\n              unit: true,\r\n            },\r\n          },\r\n          EquipmentHauled: {\r\n            select: {\r\n              id: true,\r\n              equipmentId: true,\r\n            },\r\n          },\r\n        },\r\n      }),\r\n\r\n      prisma.tascoLog.findMany({\r\n        where: {\r\n          TimeSheet: {\r\n            userId: userId,\r\n            endTime: null,\r\n          },\r\n        },\r\n        select: {\r\n          id: true,\r\n          shiftType: true,\r\n          laborType: true,\r\n          LoadQuantity: true,\r\n          RefuelLogs: {\r\n            select: {\r\n              id: true,\r\n              gallonsRefueled: true,\r\n            },\r\n          },\r\n          TascoFLoads: {\r\n            select: {\r\n              id: true,\r\n              weight: true,\r\n              screenType: true,\r\n            },\r\n          },\r\n        },\r\n      }),\r\n    ]);\r\n\r\n  // Enhanced validation functions for different field types\r\n  const validateField = {\r\n    // Basic validation - field must not be empty/null/undefined\r\n    required: (value: unknown): boolean => {\r\n      return value !== null && value !== undefined && value !== \"\";\r\n    },\r\n\r\n    // Mileage validation - must exist and be >= starting mileage\r\n    mileage: (value: unknown, startingMileage: number | null): boolean => {\r\n      if (!validateField.required(value)) return false;\r\n      if (startingMileage === null) return true; // Can't validate without starting mileage\r\n      return typeof value === \"number\" && value >= startingMileage;\r\n    },\r\n\r\n    // Numeric validation - must be a positive number\r\n    positiveNumber: (value: unknown): boolean => {\r\n      if (!validateField.required(value)) return false;\r\n      return typeof value === \"number\" && value > 0;\r\n    },\r\n  };\r\n\r\n  // Validation rules for each log type\r\n  const validateTruckingLog = (log: {\r\n    laborType: string;\r\n    startingMileage: number | null;\r\n    endingMileage: number | null;\r\n    StateMileages: Array<{\r\n      state: string | null;\r\n      stateLineMileage: number | null;\r\n    }>;\r\n    RefuelLogs: Array<{\r\n      gallonsRefueled: number | null;\r\n      milesAtFueling: number | null;\r\n    }>;\r\n    Materials: Array<{\r\n      LocationOfMaterial: string | null;\r\n      name: string | null;\r\n      quantity: number | null;\r\n      unit: string | null;\r\n    }>;\r\n    EquipmentHauled: Array<{\r\n      equipmentId: string | null;\r\n    }>;\r\n  }) => {\r\n    const startingMileage = log.startingMileage;\r\n\r\n    // Calculate minimum end mileage (highest mileage from all logs)\r\n    let maxMileage = startingMileage || 0;\r\n\r\n    // Check state mileage logs\r\n    log.StateMileages.forEach((stateLog) => {\r\n      if (stateLog.stateLineMileage && stateLog.stateLineMileage > maxMileage) {\r\n        maxMileage = stateLog.stateLineMileage;\r\n      }\r\n    });\r\n\r\n    // Check refuel logs\r\n    log.RefuelLogs.forEach((refuelLog) => {\r\n      if (refuelLog.milesAtFueling && refuelLog.milesAtFueling > maxMileage) {\r\n        maxMileage = refuelLog.milesAtFueling;\r\n      }\r\n    });\r\n\r\n    return {\r\n      // State mileage validation\r\n      stateMileage: log.StateMileages.some(\r\n        (item) =>\r\n          !validateField.required(item.state) ||\r\n          !validateField.mileage(item.stateLineMileage, startingMileage)\r\n      ),\r\n\r\n      // Refuel logs validation\r\n      refueled: log.RefuelLogs.some(\r\n        (item) =>\r\n          !validateField.positiveNumber(item.gallonsRefueled) ||\r\n          !validateField.mileage(item.milesAtFueling, startingMileage)\r\n      ),\r\n\r\n      // Material validation\r\n      material: log.Materials.some(\r\n        (item) =>\r\n          !validateField.required(item.LocationOfMaterial) ||\r\n          !validateField.required(item.name) ||\r\n          !validateField.positiveNumber(item.quantity) ||\r\n          !validateField.required(item.unit)\r\n      ),\r\n\r\n      // Equipment hauled validation\r\n      equipmentHauled: log.EquipmentHauled.some(\r\n        (item) => !validateField.required(item.equipmentId)\r\n      ),\r\n\r\n      // Enhanced ending mileage validation for truck drivers\r\n      endingMileage:\r\n        log.laborType === \"truckDriver\" &&\r\n        (!validateField.required(log.endingMileage) ||\r\n          (log.endingMileage !== null && log.endingMileage < maxMileage)),\r\n    };\r\n  };\r\n\r\n  const mappedEmployeeLogs: EquipmentLog[] = employeeLogs.map((log) => ({\r\n    id: log.id.toString(),\r\n    type: \"equipment\",\r\n    userId: userId,\r\n    equipment: log.Equipment\r\n      ? {\r\n          id: log.Equipment.id.toString(),\r\n          qrId: log.Equipment.qrId,\r\n          name: log.Equipment.name,\r\n        }\r\n      : null,\r\n  }));\r\n\r\n  // Mapping Maintenance Logs\r\n  const mappedMaintenanceLogs: MaintenanceLog[] = maintenanceLogs.map(\r\n    (log) => ({\r\n      id: log.id.toString(),\r\n      type: \"mechanic\",\r\n      maintenanceId: log.maintenanceId,\r\n      userId: userId,\r\n      submitted: false,\r\n    })\r\n  );\r\n\r\n  // Mapping Trucking Logs and Checking for Incomplete Fields\r\n  const mappedTruckingLogs: TruckingLog[] = truckingLogs\r\n    .map((log) => {\r\n      const validation = validateTruckingLog(log);\r\n\r\n      return {\r\n        id: log.id,\r\n        type: \"Trucking Assistant\",\r\n        laborType: log.laborType,\r\n        endingMileage: log.endingMileage,\r\n        stateMileage: validation.stateMileage,\r\n        refueled: validation.refueled,\r\n        material: validation.material,\r\n        equipmentHauled: validation.equipmentHauled,\r\n        incomplete: validation.endingMileage,\r\n      };\r\n    })\r\n    .filter((log) => {\r\n      // Filter logs with incomplete fields\r\n      return (\r\n        log.incomplete ||\r\n        log.stateMileage ||\r\n        log.refueled ||\r\n        log.material ||\r\n        log.equipmentHauled\r\n      );\r\n    });\r\n\r\n  const mappedTascoLog: TascoLog[] = tascoLogs\r\n    .map((log) => {\r\n      return {\r\n        id: log.id,\r\n        type: \"tasco\",\r\n        shiftType: log.shiftType,\r\n        laborType: log.laborType,\r\n        loadQuantity: log.LoadQuantity,\r\n        refueled: log.RefuelLogs.some(\r\n          (item) => !validateField.positiveNumber(item.gallonsRefueled)\r\n        ),\r\n        fLoads: log.TascoFLoads.some(\r\n          (item) =>\r\n            !validateField.positiveNumber(item.weight) ||\r\n            !validateField.required(item.screenType)\r\n        ),\r\n      };\r\n    })\r\n    .filter((log) => {\r\n      // Filter logs with incomplete fields\r\n      return log.refueled || log.fLoads;\r\n    });\r\n\r\n  // Combine All Logs\r\n  const combinedLogs = [\r\n    ...mappedEmployeeLogs,\r\n    ...mappedMaintenanceLogs,\r\n    ...mappedTruckingLogs,\r\n    ...mappedTascoLog,\r\n  ];\r\n\r\n  return combinedLogs;\r\n}\r\n\r\nexport async function getClockOutComment(userId: string) {\r\n  const timesheet = await prisma.timeSheet.findFirst({\r\n    where: {\r\n      userId,\r\n      endTime: null, // Ensure timesheet is still active\r\n    },\r\n    orderBy: {\r\n      createdAt: \"desc\", // Sort by most recent submission date\r\n    },\r\n    select: {\r\n      comment: true,\r\n    },\r\n  });\r\n  return timesheet?.comment || \"\";\r\n}\r\n\r\nexport async function getEquipmentLogs(userId: string, timesheetId: number) {\r\n  const logs = await prisma.employeeEquipmentLog.findMany({\r\n    where: {\r\n      timeSheetId: timesheetId,\r\n      TimeSheet: {\r\n        userId: userId,\r\n      },\r\n    },\r\n    include: {\r\n      Equipment: true,\r\n    },\r\n    orderBy: {\r\n      startTime: \"desc\",\r\n    },\r\n  });\r\n\r\n  return logs;\r\n}\r\n\r\nexport async function getRecentJobDetails(userId: string) {\r\n  const timesheet = await prisma.timeSheet.findFirst({\r\n    where: {\r\n      userId,\r\n      endTime: null, // Ensure timesheet is still active\r\n    },\r\n    orderBy: {\r\n      createdAt: \"desc\", // Sort by most recent submission date\r\n    },\r\n    select: {\r\n      Jobsite: {\r\n        select: {\r\n          id: true,\r\n          name: true,\r\n          qrId: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n  const job = timesheet?.Jobsite;\r\n  if (!job) {\r\n    throw new Error(\"No active job found.\");\r\n  }\r\n  return job;\r\n}\r\n\r\nexport async function getAllEquipmentLogs() {\r\n  const logs = await prisma.employeeEquipmentLog.findMany({\r\n    select: {\r\n      id: true,\r\n    },\r\n  });\r\n  return logs;\r\n}\r\n\r\nexport async function createEmployeeEquipmentLogService({\r\n  equipmentId,\r\n  timeSheetId,\r\n  endTime,\r\n  comment,\r\n}: {\r\n  equipmentId: string;\r\n  timeSheetId: string;\r\n  endTime?: string | null;\r\n  comment?: string | null;\r\n}) {\r\n  try {\r\n    // Validate equipment existence and status\r\n    let equipmentExists = await prisma.equipment.findFirst({\r\n      where: { id: equipmentId, status: \"ACTIVE\" },\r\n    });\r\n\r\n    if (!equipmentExists) {\r\n      equipmentExists = await prisma.equipment.findFirst({\r\n        where: { qrId: equipmentId, status: \"ACTIVE\" },\r\n      });\r\n    }\r\n\r\n    if (!equipmentExists) {\r\n      const equipmentAnyStatus = await prisma.equipment.findFirst({\r\n        where: { OR: [{ id: equipmentId }, { qrId: equipmentId }] },\r\n        select: { status: true },\r\n      });\r\n\r\n      if (equipmentAnyStatus) {\r\n        throw new Error(\r\n          `Equipment with ID ${equipmentId} is ${equipmentAnyStatus.status.toLowerCase()}. Please scan an active equipment QR code.`\r\n        );\r\n      } else {\r\n        throw new Error(\r\n          `Equipment with ID ${equipmentId} not found. Please scan a valid equipment QR code.`\r\n        );\r\n      }\r\n    }\r\n\r\n    // Validate timesheet existence and status\r\n    const timeSheet = await prisma.timeSheet.findUnique({\r\n      where: { id: parseInt(timeSheetId, 10) },\r\n      select: { id: true, endTime: true },\r\n    });\r\n\r\n    if (!timeSheet) {\r\n      throw new Error(\"Invalid timesheet ID. Please clock in again.\");\r\n    }\r\n\r\n    if (timeSheet.endTime) {\r\n      throw new Error(\r\n        \"This timesheet has been closed. Please clock in again before logging equipment.\"\r\n      );\r\n    }\r\n\r\n    // Create the employee equipment log\r\n    const newLog = await prisma.employeeEquipmentLog.create({\r\n      data: {\r\n        equipmentId: equipmentExists.id,\r\n        timeSheetId: timeSheet.id,\r\n        startTime: new Date().toISOString(),\r\n        endTime: endTime ? new Date(endTime) : null,\r\n        comment: comment ?? null,\r\n      },\r\n    });\r\n\r\n    return newLog;\r\n  } catch (error) {\r\n    console.error(\"Error in createEmployeeEquipmentLogService:\", error);\r\n    throw error;\r\n  }\r\n}\r\n\r\nexport async function getEmployeeEquipmentLogDetails(logId: string) {\r\n  const usersLog = await prisma.employeeEquipmentLog.findFirst({\r\n    where: {\r\n      id: logId,\r\n    },\r\n    select: {\r\n      id: true,\r\n      equipmentId: true,\r\n      startTime: true,\r\n      endTime: true,\r\n      comment: true,\r\n      Equipment: {\r\n        select: {\r\n          id: true,\r\n          name: true,\r\n          state: true,\r\n          equipmentTag: true,\r\n          make: true,\r\n          model: true,\r\n          year: true,\r\n          licensePlate: true,\r\n        },\r\n      },\r\n      RefuelLog: {\r\n        select: {\r\n          id: true,\r\n          gallonsRefueled: true,\r\n        },\r\n      },\r\n      Maintenance: {\r\n        select: {\r\n          id: true,\r\n          equipmentIssue: true,\r\n          additionalInfo: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n  return usersLog;\r\n}\r\n\r\nexport async function deleteEmployeeEquipmentLog(logId: string) {\r\n  try {\r\n    await prisma.employeeEquipmentLog.delete({\r\n      where: {\r\n        id: logId,\r\n      },\r\n    });\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error(\"Error deleting equipment log:\", error);\r\n    return { success: false, error: \"Failed to delete equipment log.\" };\r\n  }\r\n}\r\n\r\nexport async function updateEmployeeEquipmentLogService({\r\n  id,\r\n  equipmentId,\r\n  startTime,\r\n  endTime,\r\n  comment,\r\n  status,\r\n  disconnectRefuelLog,\r\n  refuelLogId,\r\n  gallonsRefueled,\r\n}: {\r\n  id: string;\r\n  equipmentId: string;\r\n  startTime: string;\r\n  endTime?: string;\r\n  comment?: string;\r\n  status?: EquipmentState;\r\n  disconnectRefuelLog?: boolean;\r\n  refuelLogId?: string | null;\r\n  gallonsRefueled?: number | null;\r\n}) {\r\n  try {\r\n    const result = await prisma.$transaction(async (prisma) => {\r\n      const actualRefuelLogId = refuelLogId === \"__NULL__\" ? null : refuelLogId;\r\n      const actualGallonsRefueled =\r\n        gallonsRefueled === null ? null : gallonsRefueled;\r\n\r\n      let refuelLogUpdate = {};\r\n      if (disconnectRefuelLog) {\r\n        refuelLogUpdate = { disconnect: true };\r\n      } else if (actualGallonsRefueled && actualRefuelLogId) {\r\n        // Check if RefuelLog exists for this EmployeeEquipmentLog\r\n        const existingRefuelLog = await prisma.refuelLog.findFirst({\r\n          where: { id: actualRefuelLogId, employeeEquipmentLogId: id },\r\n        });\r\n        if (existingRefuelLog) {\r\n          refuelLogUpdate = {\r\n            update: {\r\n              where: { id: actualRefuelLogId },\r\n              data: { gallonsRefueled: actualGallonsRefueled },\r\n            },\r\n          };\r\n        } else {\r\n          // Fallback to create if not found\r\n          refuelLogUpdate = {\r\n            create: {\r\n              gallonsRefueled: actualGallonsRefueled,\r\n            },\r\n          };\r\n        }\r\n      } else if (actualGallonsRefueled) {\r\n        refuelLogUpdate = {\r\n          create: {\r\n            gallonsRefueled: actualGallonsRefueled,\r\n          },\r\n        };\r\n      }\r\n\r\n      // Build update data object conditionally\r\n      const updateData: Prisma.EmployeeEquipmentLogUpdateInput = {};\r\n      if (typeof startTime !== \"undefined\") updateData.startTime = startTime;\r\n      if (typeof endTime !== \"undefined\")\r\n        updateData.endTime = endTime || new Date().toISOString();\r\n      if (typeof comment !== \"undefined\") updateData.comment = comment ?? null;\r\n      if (Object.keys(refuelLogUpdate).length > 0)\r\n        updateData.RefuelLog = refuelLogUpdate;\r\n\r\n      const log = await prisma.employeeEquipmentLog.update({\r\n        where: { id },\r\n        data: updateData,\r\n        include: {\r\n          Equipment: true,\r\n          TimeSheet: {\r\n            include: {\r\n              User: { select: { firstName: true, lastName: true } },\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      if (!log) {\r\n        throw new Error(\"Equipment log not found\");\r\n      }\r\n\r\n      if (status) {\r\n        await prisma.equipment.update({\r\n          where: { id: equipmentId },\r\n          data: { state: status },\r\n        });\r\n      }\r\n\r\n      return {\r\n        name: log.Equipment ? log.Equipment.name : null,\r\n        id: log.Equipment ? log.Equipment.id : null,\r\n        createdBy:\r\n          log.TimeSheet && log.TimeSheet.User\r\n            ? `${log.TimeSheet.User.firstName} ${log.TimeSheet.User.lastName}`\r\n            : null,\r\n      };\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: \"Equipment log updated successfully\",\r\n      data: result,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error updating employee equipment log:\", error);\r\n    throw new Error(`Failed to update employee equipment log: ${error}`);\r\n  }\r\n}\r\n\r\nexport async function getClockOutDetailsService(userId: string) {\r\n  // Get today's date range\r\n  const startOfDay = new Date();\r\n  startOfDay.setHours(0, 0, 0, 0);\r\n  const endOfDay = new Date();\r\n  endOfDay.setHours(23, 59, 59, 999);\r\n\r\n  // Fetch all required data in parallel\r\n  const [timesheets, user, previousComment] = await Promise.all([\r\n    prisma.timeSheet.findMany({\r\n      where: {\r\n        userId,\r\n        startTime: { gte: startOfDay, lte: endOfDay },\r\n      },\r\n      include: {\r\n        Jobsite: true,\r\n        TascoLogs: true,\r\n        TruckingLogs: true,\r\n      },\r\n      orderBy: { startTime: \"desc\" },\r\n    }),\r\n\r\n    prisma.user.findUnique({\r\n      where: { id: userId },\r\n      select: { signature: true },\r\n    }),\r\n\r\n    prisma.timeSheet.findFirst({\r\n      where: {\r\n        userId,\r\n        endTime: null,\r\n      },\r\n      orderBy: {\r\n        createdAt: \"desc\",\r\n      },\r\n      select: {\r\n        comment: true,\r\n      },\r\n    }),\r\n  ]);\r\n\r\n  const signature = user?.signature || \"\";\r\n  const comment = previousComment?.comment || \"\";\r\n\r\n  return { timesheets, signature, comment };\r\n}\r\nexport async function updateClockOutService(\r\n  timeSheetId: string,\r\n  userId: string,\r\n  endTime: string,\r\n  timeSheetComments?: string,\r\n  wasInjured?: boolean,\r\n  clockOutLat?: number,\r\n  clockOutLong?: number\r\n) {\r\n  try {\r\n    const transactionResult = await prisma.$transaction(async (prisma) => {\r\n      // Update the timesheet with clock-out details\r\n      const updatedTimeSheet = await prisma.timeSheet.update({\r\n        where: { id: parseInt(timeSheetId, 10), userId },\r\n        data: {\r\n          endTime: new Date(endTime),\r\n          comment: timeSheetComments || null,\r\n          wasInjured: wasInjured || false,\r\n          clockOutLat: clockOutLat || null,\r\n          clockOutLng: clockOutLong || null,\r\n          status: \"PENDING\",\r\n        },\r\n        include: {\r\n          User: {\r\n            select: {\r\n              firstName: true,\r\n              lastName: true,\r\n            },\r\n          },\r\n        },\r\n      });\r\n\r\n      // Update user status to clocked out\r\n      await prisma.user.update({\r\n        where: { id: userId },\r\n        data: {\r\n          clockedIn: false,\r\n        },\r\n      });\r\n\r\n      return { updatedTimeSheet };\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      data: transactionResult.updatedTimeSheet,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error updating clock-out details:\", error);\r\n    return {\r\n      success: false,\r\n      error: \"Failed to update clock-out details.\",\r\n    };\r\n  }\r\n}\r\n\r\nexport async function getPreviousTimesheet(userId: string) {\r\n  const timesheet = await prisma.timeSheet.findFirst({\r\n    where: {\r\n      userId,\r\n    },\r\n    orderBy: {\r\n      createdAt: \"desc\", // Sort by most recent submission date\r\n    },\r\n    select: {\r\n      id: true,\r\n      endTime: true,\r\n    },\r\n  });\r\n\r\n  return timesheet;\r\n}\r\nexport async function getContinueTimesheetService(id: number, userId: string) {\r\n  const incompleteTimesheet = await prisma.timeSheet.findFirst({\r\n    where: {\r\n      id,\r\n      userId,\r\n      endTime: null, // Ensure it's still incomplete\r\n    },\r\n    include: {\r\n      Jobsite: {\r\n        select: {\r\n          id: true,\r\n          qrId: true,\r\n          name: true,\r\n        },\r\n      },\r\n      CostCode: {\r\n        select: {\r\n          id: true,\r\n          name: true,\r\n        },\r\n      },\r\n      TascoLogs: {\r\n        select: {\r\n          shiftType: true,\r\n          laborType: true,\r\n          materialType: true,\r\n          Equipment: {\r\n            select: {\r\n              qrId: true,\r\n              name: true,\r\n            },\r\n          },\r\n        },\r\n      },\r\n      TruckingLogs: {\r\n        select: {\r\n          laborType: true,\r\n          truckNumber: true,\r\n          startingMileage: true,\r\n          Equipment: {\r\n            select: {\r\n              qrId: true,\r\n              name: true,\r\n            },\r\n          },\r\n        },\r\n      },\r\n    },\r\n  });\r\n  return incompleteTimesheet;\r\n}\r\n\r\nexport async function returnToPreviousTimesheetService(id: number) {\r\n  const PrevTimeSheet = await prisma.timeSheet.findUnique({\r\n    where: { id },\r\n    select: {\r\n      id: true,\r\n      Jobsite: {\r\n        select: {\r\n          id: true,\r\n          qrId: true,\r\n          name: true,\r\n        },\r\n      },\r\n      CostCode: {\r\n        select: {\r\n          id: true,\r\n          name: true,\r\n        },\r\n      },\r\n      workType: true,\r\n      TascoLogs: {\r\n        select: {\r\n          shiftType: true,\r\n          Equipment: {\r\n            select: {\r\n              id: true,\r\n              qrId: true,\r\n              name: true,\r\n            },\r\n          },\r\n          laborType: true,\r\n          materialType: true,\r\n        },\r\n      },\r\n      TruckingLogs: {\r\n        select: {\r\n          laborType: true,\r\n          Equipment: {\r\n            select: {\r\n              qrId: true,\r\n              name: true,\r\n            },\r\n          },\r\n          startingMileage: true,\r\n        },\r\n      },\r\n    },\r\n  });\r\n\r\n  return PrevTimeSheet;\r\n}\r\n\r\n/**\r\n * Delete a refuel log for equipment logs\r\n */\r\nexport async function deleteRefuelLogService(refuelLogId: string) {\r\n  try {\r\n    const deletedRefuelLog = await prisma.refuelLog.delete({\r\n      where: {\r\n        id: refuelLogId,\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: \"Refuel log deleted successfully\",\r\n      data: deletedRefuelLog,\r\n    };\r\n  } catch (error) {\r\n    if (error instanceof Error) {\r\n      throw new Error(`Failed to delete refuel log: ${error.message}`);\r\n    }\r\n    throw new Error(\"Failed to delete refuel log\");\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debug_id":"079e2405-1c7d-58c2-9649-8d91c840f0bd"}