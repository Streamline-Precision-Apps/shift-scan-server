{"version":3,"file":"adminTimesheetService.js","sources":["src/services/adminTimesheetService.ts"],"sourceRoot":"/","sourcesContent":["import prisma from \"../lib/prisma.js\";\nimport type { ApprovalStatus, Prisma } from \"../../generated/prisma/index.js\";\n\ninterface FilterOptions {\n  jobsiteId: string[];\n  costCode: string[];\n  equipmentId: string[];\n  equipmentLogTypes: string[];\n  status: string[];\n  changes: string[];\n  id: string[];\n  notificationId: string[];\n  dateRange: { from?: Date | undefined; to?: Date | undefined };\n}\n\ninterface GetAllTimesheetsParams {\n  status: string;\n  page: number;\n  pageSize: number;\n  skip: number;\n  search: string;\n  filters: FilterOptions;\n}\n\nexport async function getAllTimesheets(params: GetAllTimesheetsParams) {\n  try {\n    const { status, page, pageSize, skip, search, filters } = params;\n\n    // Build where clause based on filters\n    const where: Prisma.TimeSheetWhereInput = {};\n\n    // Status filter - combine both the showPendingOnly status param and the filters.status array\n    // Priority: filters.status (from filter dropdown) takes precedence over status param (showPendingOnly)\n    if (filters.status && filters.status.length > 0) {\n      // Use filter dropdown selections\n      const validStatuses = filters.status\n        .filter((s) => s.toLowerCase() !== \"all\")\n        .map((s) => s.toUpperCase());\n      if (validStatuses.length > 0) {\n        where.status = {\n          in: validStatuses as ApprovalStatus[],\n        };\n      }\n    } else if (status && status !== \"all\") {\n      // Fall back to showPendingOnly status param only if no filter status is selected\n      if (status.toLowerCase() === \"pending\") {\n        where.status = \"PENDING\" as ApprovalStatus;\n      } else {\n        // For specific status values, convert to uppercase and cast to enum\n        where.status = status.toUpperCase() as ApprovalStatus;\n      }\n    }\n\n    // Search across user names, jobsite names, cost codes\n    if (search) {\n      where.OR = [\n        {\n          User: {\n            OR: [\n              { firstName: { contains: search, mode: \"insensitive\" } },\n              { lastName: { contains: search, mode: \"insensitive\" } },\n            ],\n          },\n        },\n        {\n          Jobsite: {\n            OR: [\n              { name: { contains: search, mode: \"insensitive\" } },\n              { code: { contains: search, mode: \"insensitive\" } },\n            ],\n          },\n        },\n        {\n          CostCode: {\n            OR: [\n              { name: { contains: search, mode: \"insensitive\" } },\n              { code: { contains: search, mode: \"insensitive\" } },\n            ],\n          },\n        },\n      ];\n    }\n\n    // Jobsite filter\n    if (filters.jobsiteId && filters.jobsiteId.length > 0) {\n      where.jobsiteId = { in: filters.jobsiteId };\n    }\n\n    // Cost code filter\n    if (filters.costCode && filters.costCode.length > 0) {\n      where.costcode = { in: filters.costCode };\n    }\n\n    // ID filter\n    if (filters.id && filters.id.length > 0) {\n      where.id = { in: filters.id.map((id) => parseInt(id, 10)) };\n    }\n\n    // Date range filter\n    if (filters.dateRange?.from || filters.dateRange?.to) {\n      where.date = {};\n      if (filters.dateRange.from) {\n        where.date.gte = filters.dateRange.from;\n      }\n      if (filters.dateRange.to) {\n        where.date.lte = filters.dateRange.to;\n      }\n    }\n\n    // Equipment filter (across all log types)\n    if (filters.equipmentId && filters.equipmentId.length > 0) {\n      const equipmentConditions: Prisma.TimeSheetWhereInput[] = [];\n\n      if (\n        !filters.equipmentLogTypes ||\n        filters.equipmentLogTypes.length === 0 ||\n        filters.equipmentLogTypes.includes(\"employeeEquipmentLogs\")\n      ) {\n        equipmentConditions.push({\n          EmployeeEquipmentLogs: {\n            some: { equipmentId: { in: filters.equipmentId } },\n          },\n        });\n      }\n\n      if (\n        !filters.equipmentLogTypes ||\n        filters.equipmentLogTypes.length === 0 ||\n        filters.equipmentLogTypes.includes(\"truckingLogs\")\n      ) {\n        equipmentConditions.push({\n          TruckingLogs: {\n            some: {\n              OR: [\n                // Check hauled equipment\n                { Equipment: { id: { in: filters.equipmentId } } },\n                // Check truck\n                { Truck: { id: { in: filters.equipmentId } } },\n                // Check trailer\n                { Trailer: { id: { in: filters.equipmentId } } },\n                // Check equipment hauled records\n                {\n                  EquipmentHauled: {\n                    some: { equipmentId: { in: filters.equipmentId } },\n                  },\n                },\n              ],\n            },\n          },\n        });\n      }\n\n      if (\n        !filters.equipmentLogTypes ||\n        filters.equipmentLogTypes.length === 0 ||\n        filters.equipmentLogTypes.includes(\"tascoLogs\")\n      ) {\n        equipmentConditions.push({\n          TascoLogs: {\n            some: {\n              equipmentId: { in: filters.equipmentId },\n            },\n          },\n        });\n      }\n\n      if (\n        !filters.equipmentLogTypes ||\n        filters.equipmentLogTypes.length === 0 ||\n        filters.equipmentLogTypes.includes(\"mechanicProjects\")\n      ) {\n        equipmentConditions.push({\n          Maintenance: {\n            some: {\n              equipmentId: { in: filters.equipmentId },\n            },\n          },\n        });\n      }\n\n      if (equipmentConditions.length > 0) {\n        where.OR = [...(where.OR || []), ...equipmentConditions];\n      }\n    }\n\n    // Changes filter (has change logs)\n    if (filters.changes && filters.changes.includes(\"hasChanges\")) {\n      where.ChangeLogs = {\n        some: {},\n      };\n    }\n\n    // Count total matching records\n    const total = await prisma.timeSheet.count({ where });\n\n    // Calculate total pages\n    const totalPages = Math.ceil(total / pageSize);\n\n    // Get pending count for approval inbox\n    const pendingTimesheets = await prisma.timeSheet.count({\n      where: { status: \"PENDING\" },\n    });\n\n    // Fetch timesheets with pagination\n    const timesheets = await prisma.timeSheet.findMany({\n      where,\n      ...(status !== \"pending\" && { skip, take: pageSize }),\n      select: {\n        id: true,\n        date: true,\n        User: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n          },\n        },\n        Jobsite: {\n          select: {\n            id: true,\n            code: true,\n            name: true,\n          },\n        },\n        CostCode: {\n          select: {\n            id: true,\n            name: true,\n            code: true,\n          },\n        },\n        nu: true,\n        Fp: true,\n        startTime: true,\n        endTime: true,\n        comment: true,\n        status: true,\n        workType: true,\n        createdAt: true,\n        updatedAt: true,\n        EmployeeEquipmentLogs: {\n          select: {\n            id: true,\n            equipmentId: true,\n            Equipment: {\n              select: {\n                id: true,\n                name: true,\n              },\n            },\n            startTime: true,\n            endTime: true,\n          },\n        },\n        TruckingLogs: {\n          select: {\n            truckNumber: true,\n            startingMileage: true,\n            endingMileage: true,\n            RefuelLogs: {\n              select: {\n                milesAtFueling: true,\n              },\n            },\n          },\n        },\n        TascoLogs: {\n          select: {\n            shiftType: true,\n            LoadQuantity: true,\n          },\n        },\n        _count: {\n          select: {\n            ChangeLogs: true,\n          },\n        },\n      },\n      orderBy: {\n        date: \"desc\",\n      },\n    });\n\n    return {\n      timesheets,\n      total,\n      totalPages,\n      page: status === \"pending\" ? undefined : page,\n      pageSize: status === \"pending\" ? undefined : pageSize,\n      pendingTimesheets,\n    };\n  } catch (error) {\n    console.error(\"Error fetching timesheets:\", error);\n    throw error;\n  }\n}\n\nexport async function getTimesheetById(id: string | undefined) {\n  try {\n    return await prisma.timeSheet.findUnique({\n      where: { id: parseInt(id as string, 10) },\n      include: {\n        User: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n          },\n        },\n        Jobsite: {\n          select: {\n            id: true,\n            code: true,\n            name: true,\n          },\n        },\n        CostCode: {\n          select: {\n            id: true,\n            code: true,\n            name: true,\n          },\n        },\n        EmployeeEquipmentLogs: {\n          include: {\n            Equipment: {\n              select: {\n                id: true,\n                name: true,\n              },\n            },\n          },\n        },\n        TruckingLogs: {\n          include: {\n            Equipment: {\n              select: {\n                id: true,\n                name: true,\n              },\n            },\n            Truck: {\n              select: {\n                id: true,\n                name: true,\n              },\n            },\n            Trailer: {\n              select: {\n                id: true,\n                name: true,\n              },\n            },\n            EquipmentHauled: {\n              include: {\n                Equipment: {\n                  select: {\n                    id: true,\n                    name: true,\n                  },\n                },\n              },\n            },\n            Materials: true,\n            RefuelLogs: true,\n            StateMileages: true,\n          },\n        },\n        TascoLogs: {\n          include: {\n            Equipment: {\n              select: {\n                id: true,\n                name: true,\n              },\n            },\n            RefuelLogs: true,\n            TascoFLoads: true,\n          },\n        },\n        Maintenance: {\n          include: {\n            Equipment: {\n              select: {\n                id: true,\n                name: true,\n              },\n            },\n          },\n        },\n        ChangeLogs: {\n          include: {\n            User: {\n              select: {\n                id: true,\n                firstName: true,\n                lastName: true,\n              },\n            },\n          },\n          orderBy: {\n            changedAt: \"desc\",\n          },\n        },\n      },\n    });\n  } catch (error) {\n    console.error(\"Error fetching timesheet by ID:\", error);\n    throw error;\n  }\n}\n\nexport async function getTimesheetChangeLogs(timesheetId: string | undefined) {\n  try {\n    return await prisma.timeSheetChangeLog.findMany({\n      where: { timeSheetId: parseInt(timesheetId as string, 10) },\n      include: {\n        User: {\n          select: {\n            id: true,\n            firstName: true,\n            lastName: true,\n          },\n        },\n      },\n      orderBy: {\n        changedAt: \"desc\",\n      },\n    });\n  } catch (error) {\n    console.error(\"Error fetching change logs:\", error);\n    throw error;\n  }\n}\n\nexport async function createTimesheet(payload: any) {\n  try {\n    console.log(\"üîµ [CREATE TIMESHEET] Received payload:\", JSON.stringify(payload, null, 2));\n    \n    // Extract main timesheet data\n    const {\n      date,\n      userId,\n      jobsiteId,\n      costcode,\n      startTime,\n      endTime,\n      workType,\n      comments,\n      employeeEquipmentLogs = [],\n      truckingLogs = [],\n      tascoLogs = [],\n      mechanicProjects = [],\n    } = payload;\n\n    console.log(\"üîµ [CREATE TIMESHEET] Extracted data:\", {\n      date,\n      userId,\n      jobsiteId,\n      costcode,\n      startTime,\n      endTime,\n      workType,\n      employeeEquipmentLogsCount: employeeEquipmentLogs.length,\n      truckingLogsCount: truckingLogs.length,\n      tascoLogsCount: tascoLogs.length,\n      mechanicProjectsCount: mechanicProjects.length,\n    });\n\n    // Create timesheet with nested logs\n    const timesheet = await prisma.timeSheet.create({\n      data: {\n        date: new Date(date),\n        userId,\n        jobsiteId,\n        costcode,\n        startTime: startTime ? new Date(startTime) : new Date(date), // Use date as default if startTime not provided\n        endTime: endTime ? new Date(endTime) : null,\n        workType,\n        comment: comments || \"\",\n        status: \"PENDING\",\n        // Create employee equipment logs\n        EmployeeEquipmentLogs: {\n          create: employeeEquipmentLogs.map((log: any) => ({\n            equipmentId: log.equipmentId,\n            startTime: new Date(log.startTime),\n            endTime: new Date(log.endTime),\n          })),\n        },\n        // Create trucking logs with nested data\n        TruckingLogs: {\n          create: truckingLogs.map((log: any) => ({\n            equipmentId: log.equipmentId,\n            truckNumber: log.truckNumber,\n            trailerNumber: log.trailerNumber || null,\n            laborType: log.laborType || \"Truck Driver\", // Required field, default to \"Truck Driver\"\n            startingMileage: parseFloat(log.startingMileage) || 0,\n            endingMileage: parseFloat(log.endingMileage) || 0,\n            EquipmentHauled: {\n              create: (log.equipmentHauled || []).map((eq: any) => ({\n                equipmentId: eq.equipmentId, // Fixed: was eq.equipment.id\n                source: eq.source || \"\",\n                destination: eq.destination || \"\",\n                startMileage: parseFloat(eq.startMileage) || 0,\n                endMileage: parseFloat(eq.endMileage) || 0,\n              })),\n            },\n            Materials: {\n              create: (log.materials || []).map((mat: any) => ({\n                LocationOfMaterial: mat.location || \"\",\n                name: mat.name || \"\",\n                quantity: parseFloat(mat.quantity) || 0,\n                unit: mat.unit || \"TONS\",\n                loadType: mat.loadType ? mat.loadType.toUpperCase() : \"SCREENED\", // Convert to uppercase for Prisma enum\n              })),\n            },\n            RefuelLogs: {\n              create: (log.refuelLogs || []).map((refuel: any) => ({\n                gallonsRefueled: parseFloat(refuel.gallonsRefueled) || 0,\n                milesAtFueling: parseFloat(refuel.milesAtFueling) || 0,\n              })),\n            },\n            StateMileages: {\n              create: (log.stateMileages || []).map((state: any) => ({\n                state: state.state,\n                stateLineMileage: parseFloat(state.stateLineMileage) || 0,\n              })),\n            },\n          })),\n        },\n        // Create Tasco logs\n        TascoLogs: {\n          create: tascoLogs.map((log: any) => ({\n            shiftType: log.shiftType,\n            laborType: log.laborType || \"\",\n            materialType: log.materialType || \"\",\n            LoadQuantity: parseFloat(log.LoadQuantity) || 0,\n            equipmentId: log.equipmentId || null,\n            RefuelLogs: {\n              create: (log.refuelLogs || []).map((refuel: any) => ({\n                gallonsRefueled: parseFloat(refuel.gallonsRefueled) || 0,\n                milesAtFueling: parseFloat(refuel.milesAtFueling) || null,\n              })),\n            },\n            TascoFLoads: {\n              create: (log.TascoFLoads || []).map((fLoad: any) => ({\n                weight: parseFloat(fLoad.weight) || null,\n                screenType: fLoad.screenType || null,\n              })),\n            },\n          })),\n        },\n        // Create mechanic projects\n        Maintenance: {\n          create: mechanicProjects.map((project: any) => ({\n            equipmentId: project.equipmentId,\n            hours: parseFloat(project.hours) || null,\n            description: project.description || \"\",\n          })),\n        },\n      },\n      include: {\n        User: true,\n        Jobsite: true,\n        CostCode: true,\n      },\n    });\n\n    console.log(\"‚úÖ [CREATE TIMESHEET] Successfully created timesheet:\", timesheet.id);\n    return timesheet;\n  } catch (error) {\n    console.error(\"‚ùå [CREATE TIMESHEET] Error creating timesheet:\", error);\n    if (error instanceof Error) {\n      console.error(\"‚ùå [CREATE TIMESHEET] Error message:\", error.message);\n      console.error(\"‚ùå [CREATE TIMESHEET] Error stack:\", error.stack);\n    }\n    throw error;\n  }\n}\n\nexport async function updateTimesheet(\n  id: string | undefined,\n  updateData: {\n    data: any;\n    originalData: any;\n    changes: Record<string, { old: unknown; new: unknown }>;\n    editorId: string;\n    changeReason: string;\n    wasStatusChanged: boolean;\n    numberOfChanges: number;\n  }\n) {\n  try {\n    const { data, changes, editorId, changeReason, wasStatusChanged } =\n      updateData;\n\n    // Extract IDs from nested objects if they exist\n    const jobsiteId = data.Jobsite?.id || data.jobsiteId;\n    const userId = data.User?.id || data.userId;\n    \n    // For costcode, we need to query the CostCode table by ID to get the actual name\n    // because the foreign key references CostCode.name, not CostCode.id\n    let costCodeName = data.costcode; // fallback to existing value\n    if (data.CostCode?.id) {\n      const costCode = await prisma.costCode.findUnique({\n        where: { id: data.CostCode.id },\n        select: { name: true }\n      });\n      if (costCode) {\n        costCodeName = costCode.name;\n      }\n    }\n\n    // Build update data object, only including defined values\n    const updateFields: any = {};\n    if (data.date) updateFields.date = new Date(data.date);\n    if (userId) updateFields.userId = userId;\n    if (jobsiteId) updateFields.jobsiteId = jobsiteId;\n    if (costCodeName) updateFields.costcode = costCodeName;\n    if (data.startTime) updateFields.startTime = new Date(data.startTime);\n    if (data.endTime !== undefined) updateFields.endTime = data.endTime ? new Date(data.endTime) : null;\n    if (data.workType) updateFields.workType = data.workType;\n    if (data.comment !== undefined) updateFields.comment = data.comment;\n    if (data.status) updateFields.status = data.status;\n\n    // Handle nested logs update\n    // For nested relations, we need to delete existing and recreate\n    // This is the simplest approach for handling changes in nested data\n    \n    // Handle EmployeeEquipmentLogs\n    if (data.EmployeeEquipmentLogs) {\n      // Delete existing logs\n      await prisma.employeeEquipmentLog.deleteMany({\n        where: { timeSheetId: parseInt(id as string, 10) },\n      });\n      // Create new logs\n      if (data.EmployeeEquipmentLogs.length > 0) {\n        await prisma.employeeEquipmentLog.createMany({\n          data: data.EmployeeEquipmentLogs.map((log: any) => ({\n            timeSheetId: parseInt(id as string, 10),\n            equipmentId: log.equipmentId,\n            startTime: new Date(log.startTime),\n            endTime: new Date(log.endTime),\n          })),\n        });\n      }\n    }\n\n    // Handle MechanicProjects (the relation is called Maintenance in the schema)\n    if (data.Maintenance) {\n      // Delete existing mechanic projects\n      await prisma.mechanicProjects.deleteMany({\n        where: { timeSheetId: parseInt(id as string, 10) },\n      });\n      // Create new mechanic projects\n      if (data.Maintenance.length > 0) {\n        await prisma.mechanicProjects.createMany({\n          data: data.Maintenance.map((project: any) => ({\n            timeSheetId: parseInt(id as string, 10),\n            equipmentId: project.equipmentId,\n            hours: parseFloat(project.hours) || 0,\n            description: project.description || \"\",\n          })),\n        });\n      }\n    }\n\n    // Handle TruckingLogs (more complex with nested relations)\n    if (data.TruckingLogs) {\n      // Delete existing trucking logs (cascade will handle nested data)\n      await prisma.truckingLog.deleteMany({\n        where: { timeSheetId: parseInt(id as string, 10) },\n      });\n      // Create new trucking logs with nested data\n      if (data.TruckingLogs.length > 0) {\n        for (const log of data.TruckingLogs) {\n          await prisma.truckingLog.create({\n            data: {\n              timeSheetId: parseInt(id as string, 10),\n              laborType: log.laborType || \"\",\n              equipmentId: log.equipmentId || null,\n              truckNumber: log.truckNumber || null,\n              trailerNumber: log.trailerNumber || null,\n              startingMileage: parseInt(log.startingMileage) || 0,\n              endingMileage: parseInt(log.endingMileage) || 0,\n              taskName: log.taskName || null,\n              EquipmentHauled: {\n                create: (log.EquipmentHauled || []).map((eq: any) => ({\n                  equipmentId: eq.equipmentId,\n                  source: eq.source || \"\",\n                  destination: eq.destination || \"\",\n                  startMileage: parseFloat(eq.startMileage) || 0,\n                  endMileage: parseFloat(eq.endMileage) || 0,\n                })),\n              },\n              Materials: {\n                create: (log.Materials || []).map((mat: any) => ({\n                  LocationOfMaterial: mat.LocationOfMaterial || \"\",\n                  name: mat.name || \"\",\n                  quantity: parseFloat(mat.quantity) || 0,\n                  unit: mat.unit || \"TONS\",\n                  loadType: mat.loadType || \"SCREENED\",\n                })),\n              },\n              RefuelLogs: {\n                create: (log.RefuelLogs || []).map((refuel: any) => ({\n                  gallonsRefueled: parseFloat(refuel.gallonsRefueled) || 0,\n                  milesAtFueling: parseFloat(refuel.milesAtFueling) || 0,\n                })),\n              },\n              StateMileages: {\n                create: (log.StateMileages || []).map((state: any) => ({\n                  state: state.state,\n                  stateLineMileage: parseInt(state.stateLineMileage) || 0,\n                })),\n              },\n            },\n          });\n        }\n      }\n    }\n\n    // Handle TascoLogs\n    if (data.TascoLogs) {\n      // Delete existing tasco logs (cascade will handle refuel logs and TascoFLoads)\n      await prisma.tascoLog.deleteMany({\n        where: { timeSheetId: parseInt(id as string, 10) },\n      });\n      // Create new tasco logs\n      if (data.TascoLogs.length > 0) {\n        for (const log of data.TascoLogs) {\n          await prisma.tascoLog.create({\n            data: {\n              timeSheetId: parseInt(id as string, 10),\n              shiftType: log.shiftType,\n              laborType: log.laborType || \"\",\n              materialType: log.materialType || null,\n              LoadQuantity: parseInt(log.LoadQuantity) || 0,\n              equipmentId: log.Equipment?.id || log.equipmentId || null,\n              RefuelLogs: {\n                create: (log.RefuelLogs || []).map((refuel: any) => ({\n                  gallonsRefueled: parseFloat(refuel.gallonsRefueled) || 0,\n                  milesAtFueling: parseFloat(refuel.milesAtFueling) || 0,\n                })),\n              },\n              TascoFLoads: {\n                create: (log.TascoFLoads || []).map((fLoad: any) => ({\n                  weight: parseFloat(fLoad.weight) || null,\n                  screenType: fLoad.screenType || null,\n                })),\n              },\n            },\n          });\n        }\n      }\n    }\n\n    // Update main timesheet fields\n    const timesheet = await prisma.timeSheet.update({\n      where: { id: parseInt(id as string, 10) },\n      data: updateFields,\n      include: {\n        User: {\n          select: {\n            firstName: true,\n            lastName: true,\n          },\n        },\n      },\n    });\n\n    // Log the changes\n    if (Object.keys(changes).length > 0) {\n      await prisma.timeSheetChangeLog.create({\n        data: {\n          timeSheetId: parseInt(id as string, 10),\n          changedBy: editorId,\n          changes: changes as any,\n          changeReason,\n        },\n      });\n    }\n\n    // Get editor name for response\n    const editor = await prisma.user.findUnique({\n      where: { id: editorId },\n      select: { firstName: true, lastName: true },\n    });\n\n    // Get user info\n    const user = await prisma.user.findUnique({\n      where: { id: data.userId },\n      select: { firstName: true, lastName: true },\n    });\n\n    return {\n      success: true,\n      onlyStatusUpdated: wasStatusChanged && Object.keys(changes).length === 1,\n      editorFullName: editor\n        ? `${editor.firstName} ${editor.lastName}`\n        : \"Unknown\",\n      userFullname: user\n        ? `${user.firstName} ${user.lastName}`\n        : \"Unknown\",\n    };\n  } catch (error) {\n    console.error(\"Error updating timesheet:\", error);\n    throw error;\n  }\n}\n\nexport async function updateTimesheetStatus(\n  id: string | undefined,\n  status: string,\n  changes: Record<string, { old: unknown; new: unknown }>,\n  userId: string\n) {\n  try {\n    const timesheetId = parseInt(id as string, 10);\n    \n    await prisma.timeSheet.update({\n      where: { id: timesheetId },\n      data: {\n        status: status as ApprovalStatus,\n      },\n    });\n\n    // Optionally log this status change\n    if (Object.keys(changes).length > 0) {\n      await prisma.timeSheetChangeLog.create({\n        data: {\n          timeSheetId: timesheetId,\n          changedBy: userId,\n          changes: changes as any,\n          changeReason: `Status changed to ${status}`,\n        },\n      });\n    }\n\n    // Handle notifications for timecard approval/denial\n    if (status === \"APPROVED\" || status === \"REJECTED\") {\n      const notifications = await prisma.notification.findMany({\n        where: {\n          topic: \"timecard-submission\",\n          referenceId: timesheetId.toString(),\n          Response: { is: null },\n        },\n      });\n\n      if (notifications.length > 0) {\n        // Filter out notifications that already have a notificationRead for this user\n        const existingReads = await prisma.notificationRead.findMany({\n          where: {\n            notificationId: { in: notifications.map((n) => n.id) },\n            userId: userId,\n          },\n          select: { notificationId: true },\n        });\n        const alreadyReadIds = new Set(\n          existingReads.map((r) => r.notificationId)\n        );\n        const unreadNotifications = notifications.filter(\n          (n) => !alreadyReadIds.has(n.id)\n        );\n\n        // Create notification responses and mark as read in a transaction\n        await prisma.$transaction(async (tx) => {\n          if (unreadNotifications.length > 0) {\n            await tx.notificationRead.createMany({\n              data: unreadNotifications.map((n) => ({\n                notificationId: n.id,\n                userId: userId,\n                readAt: new Date(),\n              })),\n            });\n          }\n          await tx.notificationResponse.createMany({\n            data: notifications.map((n) => ({\n              notificationId: n.id,\n              userId: userId,\n              response: status === \"APPROVED\" ? \"Approved\" : \"Rejected\",\n              respondedAt: new Date(),\n            })),\n          });\n        });\n      }\n    }\n  } catch (error) {\n    console.error(\"Error updating timesheet status:\", error);\n    throw error;\n  }\n}\n\nexport async function deleteTimesheet(id: string | undefined) {\n  try {\n    // Cascade delete will handle related records\n    await prisma.timeSheet.delete({\n      where: { id: parseInt(id as string, 10) },\n    });\n  } catch (error) {\n    console.error(\"Error deleting timesheet:\", error);\n    throw error;\n  }\n}\n\nexport async function exportTimesheets(\n  timesheetIds: number[],\n  fields: string[],\n  dateRange?: { from?: Date; to?: Date },\n  filters?: {\n    users?: string[];\n    crews?: string[];\n    profitCenters?: string[];\n  }\n) {\n  try {\n    // Build the where clause based on provided parameters\n    const whereClause: any = {};\n\n    // If specific IDs are provided, use them\n    if (timesheetIds && timesheetIds.length > 0) {\n      whereClause.id = { in: timesheetIds };\n    } else {\n      // Otherwise, use date range and filters\n      if (dateRange?.from || dateRange?.to) {\n        const dateFilter: any = {};\n        \n        if (dateRange.from) {\n          // Ensure we start at beginning of the day\n          const startDate = new Date(dateRange.from);\n          startDate.setHours(0, 0, 0, 0);\n          dateFilter.gte = startDate;\n        }\n        \n        if (dateRange.to) {\n          // Ensure we end at end of the day\n          const endDate = new Date(dateRange.to);\n          endDate.setHours(23, 59, 59, 999);\n          dateFilter.lte = endDate;\n        }\n        \n        whereClause.date = dateFilter;\n      }\n\n      if (filters?.users && filters.users.length > 0) {\n        whereClause.userId = { in: filters.users };\n      }\n\n      if (filters?.profitCenters && filters.profitCenters.length > 0) {\n        whereClause.jobsiteId = { in: filters.profitCenters };\n      }\n\n      // For crew filtering, we need to join through the User table\n      if (filters?.crews && filters.crews.length > 0) {\n        whereClause.User = {\n          crewId: { in: filters.crews },\n        };\n      }\n    }\n\n    const timesheets = await prisma.timeSheet.findMany({\n      where: whereClause,\n      include: {\n        User: true,\n        Jobsite: true,\n        CostCode: true,\n        EmployeeEquipmentLogs: {\n          include: {\n            Equipment: true,\n          },\n        },\n        TruckingLogs: {\n          include: {\n            Equipment: true,\n            Trailer: true,\n            EquipmentHauled: {\n              include: {\n                Equipment: true,\n              },\n            },\n            Materials: true,\n            RefuelLogs: true,\n            StateMileages: true,\n          },\n        },\n        TascoLogs: {\n          include: {\n            Equipment: true,\n            RefuelLogs: true,\n          },\n        },\n        Maintenance: {\n          include: {\n            Equipment: true,\n          },\n        },\n      },\n      orderBy: {\n        date: 'asc',\n      },\n    });\n\n    return {\n      timesheets,\n      fields,\n    };\n  } catch (error) {\n    console.error(\"Error exporting timesheets:\", error);\n    throw error;\n  }\n}\n\nexport async function getAllTascoMaterialTypes() {\n  try {\n    const materialTypes = await prisma.tascoMaterialTypes.findMany({\n      select: {\n        id: true,\n        name: true,\n      },\n      orderBy: {\n        name: 'asc',\n      },\n    });\n\n    return {\n      materialTypes,\n      total: materialTypes.length,\n    };\n  } catch (error) {\n    console.error(\"Error fetching Tasco material types:\", error);\n    throw error;\n  }\n}\n\n/**\n * Check timesheet status and resolve associated notification\n * If timesheet is already approved/rejected, create notification response\n */\nexport async function resolveTimecardNotification(\n  timesheetId: string,\n  notificationId: number,\n  userId: string\n) {\n  try {\n    // Parse timesheetId to int for Prisma query\n    const tsId = parseInt(timesheetId, 10);\n    if (isNaN(tsId)) {\n      throw new Error(\"Invalid timesheet ID\");\n    }\n\n    // Get the timesheet to check its current status\n    const timesheet = await prisma.timeSheet.findUnique({\n      where: { id: tsId },\n      select: { status: true },\n    });\n\n    if (!timesheet) {\n      throw new Error(\"Timesheet not found\");\n    }\n\n    // Check if timesheet has been approved or rejected\n    if (timesheet.status === \"APPROVED\" || timesheet.status === \"REJECTED\") {\n      // Check if notification already has a response\n      const existingResponse = await prisma.notificationResponse.findUnique({\n        where: { notificationId },\n      });\n\n      if (existingResponse) {\n        return {\n          success: true,\n          alreadyResolved: true,\n          status: timesheet.status,\n        };\n      }\n\n      // Check if user has already read this notification\n      const existingRead = await prisma.notificationRead.findUnique({\n        where: {\n          notificationId_userId: {\n            notificationId,\n            userId,\n          },\n        },\n      });\n\n      // Create notification response and read in transaction\n      await prisma.$transaction(async (tx) => {\n        // Create response with the actual status\n        await tx.notificationResponse.create({\n          data: {\n            notificationId,\n            userId,\n            response: timesheet.status === \"APPROVED\" ? \"Approved\" : \"Rejected\",\n            respondedAt: new Date(),\n          },\n        });\n\n        // Create read record if it doesn't exist\n        if (!existingRead) {\n          await tx.notificationRead.create({\n            data: {\n              notificationId,\n              userId,\n              readAt: new Date(),\n            },\n          });\n        }\n      });\n\n      return {\n        success: true,\n        resolved: true,\n        status: timesheet.status,\n      };\n    }\n\n    // Timesheet is still pending\n    return {\n      success: true,\n      resolved: false,\n      status: timesheet.status,\n    };\n  } catch (error) {\n    console.error(\"Error resolving timecard notification:\", error);\n    throw error;\n  }\n}\n"],"names":[],"mappings":"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","debug_id":"aaefea97-22cf-5d3b-8f16-7b6bf7e6d562"}